<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r6667 - in trunk/python_modules/plearn: parallel	report utilities
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6667%20-%20in%20trunk/python_modules/plearn%3A%20parallel%0A%09report%20utilities&In-Reply-To=%3C200702161600.l1GG09Rg011629%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000115.html">
   <LINK REL="Next"  HREF="000117.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r6667 - in trunk/python_modules/plearn: parallel	report utilities</H1>
    <B>dorionc at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6667%20-%20in%20trunk/python_modules/plearn%3A%20parallel%0A%09report%20utilities&In-Reply-To=%3C200702161600.l1GG09Rg011629%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r6667 - in trunk/python_modules/plearn: parallel	report utilities">dorionc at mail.berlios.de
       </A><BR>
    <I>Fri Feb 16 17:00:09 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000115.html">[Plearn-commits] r6666 - in trunk/plearn: ker var
</A></li>
        <LI>Next message: <A HREF="000117.html">[Plearn-commits] r6668 - in trunk/plearn: base sys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#116">[ date ]</a>
              <a href="thread.html#116">[ thread ]</a>
              <a href="subject.html#116">[ subject ]</a>
              <a href="author.html#116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dorionc
Date: 2007-02-16 17:00:08 +0100 (Fri, 16 Feb 2007)
New Revision: 6667

Modified:
   trunk/python_modules/plearn/parallel/dispatch.py
   trunk/python_modules/plearn/report/formatter.py
   trunk/python_modules/plearn/report/graphical_tools.py
   trunk/python_modules/plearn/utilities/pldatetime.py
Log:
- Added FIGSIZE support in FigureWrapper
- Added a PDF creator
- Minor bug fix in dispatch when no machines are currently available


Modified: trunk/python_modules/plearn/parallel/dispatch.py
===================================================================
--- trunk/python_modules/plearn/parallel/dispatch.py	2007-02-16 00:04:50 UTC (rev 6666)
+++ trunk/python_modules/plearn/parallel/dispatch.py	2007-02-16 16:00:08 UTC (rev 6667)
@@ -310,9 +310,10 @@
         except StopIteration:
             cls._available_machines = None
             if new_loop:
-                raise EmptyMachineListError
-            else:
-                return cls.nextAvailableMachine()
+                time.sleep(3)                
+                #raise EmptyMachineListError 
+            #else:
+            return cls.nextAvailableMachine()
     nextAvailableMachine = classmethod(nextAvailableMachine)
 
     #

Modified: trunk/python_modules/plearn/report/formatter.py
===================================================================
--- trunk/python_modules/plearn/report/formatter.py	2007-02-16 00:04:50 UTC (rev 6666)
+++ trunk/python_modules/plearn/report/formatter.py	2007-02-16 16:00:08 UTC (rev 6667)
@@ -30,7 +30,7 @@
 #  library, go to the PLearn Web site at www.plearn.org
 
 # Author: Christian Dorion
-import sys
+import os, sys
 from plearn.pyplearn.plearn_repr import plearn_repr
 
 DEFAULT_WRITER = sys.stdout.write
@@ -208,3 +208,62 @@
 
     return merged_table, merged_headers
         
+#####  PDF creator  #########################################################
+
+TEX_BEGIN = r&quot;&quot;&quot;
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+%% Automatically generated by the 'mytex' program
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+
+\documentclass[11pt]{article}
+\usepackage{apstat_article_style}
+\usepackage{mcgill_cover_classical}
+
+\usepackage{lscape}
+
+\include{MathStuff}
+\include{LabelsAndRefs}
+\newcommand{\prgname}[1]{\texttt{#1}}
+\newcommand{\citeP}[1]{(\citeNP{#1})} %% Since I overwrite \cite...
+\renewcommand{\cite}[1]{\citeN{#1}}
+
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+
+\renewcommand{\tabcaption}[1]{%
+  \refstepcounter{table}%
+  {\raggedright\hspace{0pt}\small\it 
+      \captionheadfont\caparrowup%
+      \tablename~\mbox{\arabic{table}}.~%
+      \captionbodyfont{#1}%
+  }}%
+
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+
+\begin{document}
+&quot;&quot;&quot;
+
+TEX_END = r&quot;&quot;&quot;
+
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
+\cleardoublepage
+\end{document}
+&quot;&quot;&quot;
+
+def createPDF(file_name, content):
+    assert file_name.endswith('.tex')    
+    if isinstance(content, list):
+        content = '\n'.join(content)
+    
+    tex_file = open(file_name, 'w')
+    tex_file.write(TEX_BEGIN)
+    tex_file.write(content)
+    tex_file.write(TEX_END)
+    tex_file.close()
+
+    pdf_name = file_name.replace(&quot;.tex&quot;, '.pdf')
+    os.system(&quot;rm -f %s&quot;%pdf_name)
+    os.system(&quot;pdflatex -interaction=nonstopmode %s &gt;&amp; /dev/null&quot;%file_name)
+    assert os.path.exists(pdf_name), &quot;PDF could not be created!&quot;
+    os.system(&quot;pdflatex %s &gt;&amp; /dev/null&quot;%file_name)
+    os.system(&quot;pdflatex %s &gt;&amp; /dev/null&quot;%file_name)

Modified: trunk/python_modules/plearn/report/graphical_tools.py
===================================================================
--- trunk/python_modules/plearn/report/graphical_tools.py	2007-02-16 00:04:50 UTC (rev 6666)
+++ trunk/python_modules/plearn/report/graphical_tools.py	2007-02-16 16:00:08 UTC (rev 6667)
@@ -33,15 +33,16 @@
 import pylab, os
 from plearn.report import GRID_COL, FONTSIZE, LEGEND_FONTPROP, TICK_LABEL_FONTPROP
 
-LEFT, WIDTH = 0.125, 0.8
+LEFT,   WIDTH  = 0.125, 0.800
+BOTTOM, HEIGHT = 0.100, 0.800
 LINE_COLORS = [ '#660033', 'b', 'r', 'k', &quot;#CDBE70&quot;,
                 &quot;#FF8C69&quot;, &quot;#65754D&quot;, &quot;#4d6575&quot;, &quot;#754d65&quot; ]
 
-__figure_counter = 0
+_figure_counter = 0
 def getNewFigure(figsize=(12,10)):
-    global __figure_counter
-    __figure_counter += 1
-    return pylab.figure(__figure_counter, figsize=figsize)
+    global _figure_counter
+    _figure_counter += 1
+    return pylab.figure(_figure_counter, figsize=figsize)
 
 def getBounds(frame):
     return [ frame.get_x(), frame.get_y(), frame.get_width(), frame.get_height() ]
@@ -52,6 +53,26 @@
 def plotZeroLine(axes, color='#666666'):
     axes.plot(axes.get_xlim(), [0,0], color=color)
 
+def same_xlim(*ax_list):
+    m, M = float('inf'), -float('inf')
+    for axes in ax_list:
+        xlim = axes.get_xlim()
+        m, M = min(m, xlim[0]), max(M, xlim[1]), 
+
+    for axes in ax_list:
+        axes.set_xlim(m, M)
+    return m, M
+
+def same_ylim(*ax_list):
+    m, M = float('inf'), -float('inf')
+    for axes in ax_list:
+        ylim = axes.get_ylim()
+        m, M = min(m, ylim[0]), max(M, ylim[1]), 
+
+    for axes in ax_list:
+        axes.set_ylim(m, M)
+    return m, M
+
 def setLegend(axes, legend_map, sorted_keys=None, loc=0):
     if not sorted_keys:
         sorted_keys = legend_map.keys(); sorted_keys.sort()
@@ -79,10 +100,13 @@
         self.max = max(limits[1], self.max)    
 
 class FigureWrapper(object):
+    FIGSIZE = (12,10)
     instances = []
-
-    def __init__(self, figsize=(12,10)):
+    
+    def __init__(self, figsize=None):
+        if figsize is None: figsize = self.FIGSIZE
         self.figure = getNewFigure(figsize)
+        self.figno  = _figure_counter  
         self.instances.append(self)
 
     def addAxes(self, rect, *args, **kwargs):

Modified: trunk/python_modules/plearn/utilities/pldatetime.py
===================================================================
--- trunk/python_modules/plearn/utilities/pldatetime.py	2007-02-16 00:04:50 UTC (rev 6666)
+++ trunk/python_modules/plearn/utilities/pldatetime.py	2007-02-16 16:00:08 UTC (rev 6667)
@@ -10,7 +10,6 @@
     cyymm,dd = divmod(cyymmdd,100)
     cyy,mm   = divmod(cyymm,100)
     yyyy = 1900+cyy
-
     return date(yyyy,mm,dd)
 
 def yyyymmdd_to_date(x):    


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000115.html">[Plearn-commits] r6666 - in trunk/plearn: ker var
</A></li>
	<LI>Next message: <A HREF="000117.html">[Plearn-commits] r6668 - in trunk/plearn: base sys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#116">[ date ]</a>
              <a href="thread.html#116">[ thread ]</a>
              <a href="subject.html#116">[ subject ]</a>
              <a href="author.html#116">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
