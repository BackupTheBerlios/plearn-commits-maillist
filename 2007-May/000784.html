<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r7335 - in trunk: plearn_learners/online	plearn_learners/online/test/ModuleLearner	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0	scripts/Skeletons
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7335%20-%20in%20trunk%3A%20plearn_learners/online%0A%09plearn_learners/online/test/ModuleLearner%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0%0A%09scripts/Skeletons&In-Reply-To=%3C200705251453.l4PErAYT030730%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000783.html">
   <LINK REL="Next"  HREF="000785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r7335 - in trunk: plearn_learners/online	plearn_learners/online/test/ModuleLearner	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0	scripts/Skeletons</H1>
    <B>tihocan at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7335%20-%20in%20trunk%3A%20plearn_learners/online%0A%09plearn_learners/online/test/ModuleLearner%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester%0A%09plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0%0A%09scripts/Skeletons&In-Reply-To=%3C200705251453.l4PErAYT030730%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r7335 - in trunk: plearn_learners/online	plearn_learners/online/test/ModuleLearner	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester	plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0	scripts/Skeletons">tihocan at mail.berlios.de
       </A><BR>
    <I>Fri May 25 16:53:10 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000783.html">[Plearn-commits] r7334 - trunk/python_modules/plearn/pymake
</A></li>
        <LI>Next message: <A HREF="000785.html">[Plearn-commits] r7336 - trunk/plearn_learners/online
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#784">[ date ]</a>
              <a href="thread.html#784">[ thread ]</a>
              <a href="subject.html#784">[ subject ]</a>
              <a href="author.html#784">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: tihocan
Date: 2007-05-25 16:53:08 +0200 (Fri, 25 May 2007)
New Revision: 7335

Modified:
   trunk/plearn_learners/online/CostModule.cc
   trunk/plearn_learners/online/CostModule.h
   trunk/plearn_learners/online/ForwardModule.cc
   trunk/plearn_learners/online/ForwardModule.h
   trunk/plearn_learners/online/LinearCombinationModule.cc
   trunk/plearn_learners/online/LinearCombinationModule.h
   trunk/plearn_learners/online/ModuleLearner.cc
   trunk/plearn_learners/online/NetworkModule.cc
   trunk/plearn_learners/online/NetworkModule.h
   trunk/plearn_learners/online/OnlineLearningModule.cc
   trunk/plearn_learners/online/OnlineLearningModule.h
   trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0/final_learner.psave
   trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0/final_learner.psave
   trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0/final_learner.psave
   trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/test_cost_names.txt
   trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Basic.plearn
   trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Greedy.pyplearn
   trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_TwoRBMs.plearn
   trunk/scripts/Skeletons/OnlineLearningModule.cc
   trunk/scripts/Skeletons/OnlineLearningModule.h
Log:
- Removed the getPortDescription method in an OnlineLearningModule, because it is not really usable when modules cannot get any extra information on the data provided to their ports.
- A ModuleLearner thus now relies on the names of the cost ports to define its costs. Note that this means currently that each cost port must be a scalar value.
- The ports in a NetworkModule are now pairs of the form 'port_name':'module.port', where 'port_name' can be left empty to reuse the full name 'module.port'
- Updated tests to take these changes into account


Modified: trunk/plearn_learners/online/CostModule.cc
===================================================================
--- trunk/plearn_learners/online/CostModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/CostModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -228,17 +228,6 @@
     inherited::fprop(ports_value);
 }
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-TVec&lt;string&gt; CostModule::getPortDescription(const string&amp; port)
-{
-    if (port == &quot;cost&quot;)
-        return name();
-    else
-        return inherited::getPortDescription(port);
-}
-
 //////////////
 // getPorts //
 //////////////

Modified: trunk/plearn_learners/online/CostModule.h
===================================================================
--- trunk/plearn_learners/online/CostModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/CostModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -148,10 +148,6 @@
     //! 'prediction', 'target' and 'cost' ports.
     virtual const TMat&lt;int&gt;&amp; getPortSizes();
 
-    //! Overridden so that the default behavior returns the name of the costs
-    //! for the 'cost' port.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
-
     //! Overridden to try to use the standard mini-batch fprop when possible.
     virtual void fprop(const TVec&lt;Mat*&gt;&amp; ports_value);
 

Modified: trunk/plearn_learners/online/ForwardModule.cc
===================================================================
--- trunk/plearn_learners/online/ForwardModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/ForwardModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -194,14 +194,6 @@
      modules[current]-&gt;setLearningRate(dynamic_learning_rate);
 }
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-TVec&lt;string&gt; ForwardModule::getPortDescription(const string&amp; port)
-{
-    return modules[current]-&gt;getPortDescription(port);
-} 
-
 //////////////
 // getPorts //
 //////////////

Modified: trunk/plearn_learners/online/ForwardModule.h
===================================================================
--- trunk/plearn_learners/online/ForwardModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/ForwardModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -138,13 +138,6 @@
     //!           are respectively 'input' and 'output')
     virtual const TMat&lt;int&gt;&amp; getPortSizes();
 
-    //! Return a list of strings, that represents the description of the values
-    //! taken by a given port: the i-th string is the name for the i-th column
-    //! value computed in 'port'.
-    //! The default version returns [ &quot;port_name_1&quot;, ..., &quot;port_name_n&quot; ] where
-    //! 'port_name' is the name of the port, and 'n' its size.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
-
     //#####  PLearn::Object Protocol  #########################################
 
     // Declares other standard object methods.

Modified: trunk/plearn_learners/online/LinearCombinationModule.cc
===================================================================
--- trunk/plearn_learners/online/LinearCombinationModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/LinearCombinationModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -224,16 +224,6 @@
 }
 */
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-/* OPTIONAL
-// The default implementation is probably appropriate
-TVec&lt;string&gt; LinearCombinationModule::getPortDescription(const string&amp; port)
-{
-} 
-*/
-
 //////////////
 // getPorts //
 //////////////

Modified: trunk/plearn_learners/online/LinearCombinationModule.h
===================================================================
--- trunk/plearn_learners/online/LinearCombinationModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/LinearCombinationModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -241,13 +241,6 @@
     //!         - 'input_size' for the first row and 'output_size' for the
     //!           second row if nPorts() &gt;= 2
     virtual const TMat&lt;int&gt;&amp; getPortSizes();
-
-    //! Return a list of strings, that represents the description of the values
-    //! taken by a given port: the i-th string is the name for the i-th column
-    //! value computed in 'port'.
-    //! The default version returns [ &quot;port_name_1&quot;, ..., &quot;port_name_n&quot; ] where
-    //! 'port_name' is the name of the port, and 'n' its size.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
     */
 
     //#####  PLearn::Object Protocol  #########################################

Modified: trunk/plearn_learners/online/ModuleLearner.cc
===================================================================
--- trunk/plearn_learners/online/ModuleLearner.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/ModuleLearner.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -456,10 +456,7 @@
 //////////////////////
 TVec&lt;string&gt; ModuleLearner::getTestCostNames() const
 {
-    TVec&lt;string&gt; cost_names;
-    for (int i = 0; i &lt; cost_ports.length(); i++)
-        cost_names.append(module-&gt;getPortDescription(cost_ports[i]));
-    return cost_names;
+    return cost_ports;
 }
 
 ///////////////////////

Modified: trunk/plearn_learners/online/NetworkModule.cc
===================================================================
--- trunk/plearn_learners/online/NetworkModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/NetworkModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -54,12 +54,12 @@
     &quot;connections between these modules.\n&quot;
     &quot;The network's ports are given through the 'ports' option. A typical\n&quot;
     &quot;value for 'ports' would be for instance something like:\n&quot;
-    &quot;   [ \&quot;input\&quot;  \&quot;rbm.visible\&quot;\n&quot;
-    &quot;     \&quot;target\&quot; \&quot;nll.target\&quot;\n&quot;
-    &quot;     \&quot;output\&quot; \&quot;rbm.hidden\&quot;\n&quot;
-    &quot;     \&quot;cost\&quot;   \&quot;nll.cost\&quot;\n&quot;
+    &quot;   [ \&quot;input\&quot;:\&quot;rbm.visible\&quot;,\n&quot;
+    &quot;     \&quot;target\&quot;:\&quot;nll.target\&quot;,\n&quot;
+    &quot;     \&quot;output\&quot;:\&quot;rbm.hidden\&quot;,\n&quot;
+    &quot;     \&quot;NLL\&quot;:\&quot;nll.cost\&quot;\n&quot;
     &quot;   ]\n&quot;
-    &quot;which means this module has four ports (input, target, output and cost)\n&quot;
+    &quot;which means this module has four ports (input, target, output and NLL)\n&quot;
     &quot;which redirect to specific ports of modules in the network.\n&quot;
 );
 
@@ -86,9 +86,10 @@
     declareOption(ol, &quot;ports&quot;, &amp;NetworkModule::ports,
                   OptionBase::buildoption,
        &quot;A sequence of pairs of strings, where each pair is of the form\n&quot;
-       &quot;('P', 'M.N') with 'M' the name of an underlying module, 'N' one of\n&quot;
+       &quot;\&quot;P\&quot;:\&quot;M.N\&quot; with 'M' the name of an underlying module, 'N' one of\n&quot;
        &quot;its ports, and 'P' the name under which the NetworkModule sees this\n&quot;
-       &quot;port. See the class help for an example with the correct syntax.&quot;);
+       &quot;port. See the class help for an example. If 'P' is an empty string,\n&quot;
+       &quot;then the port name will be 'M.N'.&quot;);
 
     declareOption(ol, &quot;save_states&quot;, &amp;NetworkModule::save_states,
                   OptionBase::buildoption,
@@ -377,7 +378,6 @@
         module_to_index[all_modules[i]] = i;
     
     // Analyze the list of ports.
-    PLASSERT( ports.length() % 2 == 0 );
     // The 'port_correspondances' lists, for each module, the correspondances
     // between the modules' ports and the ports of the NetworkModule.
     TVec&lt; TMat&lt;int&gt; &gt; port_correspondances(all_modules.length());
@@ -386,12 +386,15 @@
     TVec&lt;int&gt; new_row(2);
     all_ports.resize(0);
     port_sizes.resize(0, 2);
-    int n_ports = ports.length() / 2;
-    port_descriptions.resize(n_ports);
+    int n_ports = ports.length();
     for (int i = 0; i &lt; n_ports; i++) {
-        const string&amp; new_name = ports[2*i];
+        const pair&lt;string, string&gt;&amp; new_old = ports[i];
+        string new_name = new_old.first;
+        const string&amp; old_name = new_old.second;
+        if (new_name.empty())
+            // Empty string: we use the full name of the form 'module.port'.
+            new_name = old_name;
         all_ports.append(new_name);
-        const string&amp; old_name = ports[2*i + 1];
         size_t dot_pos = old_name.find('.');
         PLASSERT( dot_pos != string::npos );
         string old_module_name = old_name.substr(0, dot_pos);
@@ -405,7 +408,6 @@
         new_row[0] = old_module-&gt;getPortLength(old_module_port);
         new_row[1] = old_module-&gt;getPortWidth(old_module_port);
         port_sizes.appendRow(new_row);
-        port_descriptions[i] = old_module-&gt;getPortDescription(old_module_port);
     }
 
     // The i-th element of 'in_connections' maps each port in the i-th module
@@ -681,14 +683,6 @@
     }
 }
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-TVec&lt;string&gt; NetworkModule::getPortDescription(const string&amp; port)
-{
-    return port_descriptions[getPortIndex(port)];
-}
-
 //////////////
 // getPorts //
 //////////////
@@ -726,7 +720,6 @@
     deepCopyField(bprop_toresize, copies);
     deepCopyField(all_mats, copies);
     deepCopyField(all_ports, copies);
-    deepCopyField(port_descriptions, copies);
 
     // Special code to handle the deep copy of 'fprop_data' and 'bprop_data'.
     // A better way may exist to do this!

Modified: trunk/plearn_learners/online/NetworkModule.h
===================================================================
--- trunk/plearn_learners/online/NetworkModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/NetworkModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -55,7 +55,7 @@
     TVec&lt; PP&lt;OnlineLearningModule&gt; &gt; modules;
     TVec&lt; PP&lt;NetworkConnection&gt; &gt; connections;
 
-    TVec&lt;string&gt; ports;
+    TVec&lt; pair&lt;string, string &gt; &gt; ports;
 
     bool save_states;
 
@@ -83,9 +83,6 @@
     //! Return the size of each port.
     virtual const TMat&lt;int&gt;&amp; getPortSizes();
 
-    //! Return the description of a given port.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
-
     //! Reset the parameters to the state they would be BEFORE starting
     //! training.  Note that this method is necessarily called from
     //! build().
@@ -167,9 +164,6 @@
     //! The list of ports, computed from the 'ports' option.
     TVec&lt;string&gt; all_ports;
 
-    //! The description of each port, obtained from the underlying modules.
-    TVec&lt; TVec&lt;string&gt; &gt; port_descriptions;
-    
     //#####  Protected Member Functions  ######################################
 
     //! Declares the class options.

Modified: trunk/plearn_learners/online/OnlineLearningModule.cc
===================================================================
--- trunk/plearn_learners/online/OnlineLearningModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/OnlineLearningModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -261,7 +261,6 @@
     inherited::makeDeepCopyFromShallowCopy(copies);
     deepCopyField(random_gen,             copies);
     deepCopyField(port_sizes,             copies);
-    deepCopyField(port_descriptions,      copies);
     deepCopyField(tmp_input_gradient,     copies);
     deepCopyField(tmpm_input_gradient,    copies);
     deepCopyField(tmp_input_diag_hessian, copies);
@@ -332,24 +331,6 @@
     }
 }
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-TVec&lt;string&gt; OnlineLearningModule::getPortDescription(const string&amp; port)
-{
-    port_descriptions.resize(nPorts());
-    int idx = getPortIndex(port);
-    TVec&lt;string&gt;&amp; descr = port_descriptions[idx];
-    int desired_size = getPortWidth(port);
-    PLCHECK_MSG( desired_size &gt;= 0, &quot;Port width must be defined&quot; );
-    if (descr.length() != desired_size) {
-        descr.resize(desired_size);
-        for (int i = 0; i &lt; desired_size; i++)
-            descr[i] = port + &quot;_&quot; + tostring(i);
-    }
-    return descr;
-}
-
 //////////////////
 // getPortIndex //
 //////////////////

Modified: trunk/plearn_learners/online/OnlineLearningModule.h
===================================================================
--- trunk/plearn_learners/online/OnlineLearningModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/OnlineLearningModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -266,13 +266,6 @@
     //! Return name of the i-th port.
     string getPortName(int i);
 
-    //! Return a list of strings, that represents the description of the values
-    //! taken by a given port: the i-th string is the name for the i-th column
-    //! value computed in 'port'.
-    //! The default version returns [ &quot;port_name_1&quot;, ..., &quot;port_name_n&quot; ] where
-    //! 'port_name' is the name of the port, and 'n' its size.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
-
     //! This method may be called at the end of the 'fprop' or 'bpropAccUpdate'
     //! methods (respectively with 'ports_value' or 'ports_gradient' as
     //! argument) in order to ensure all required ports have been properly
@@ -301,10 +294,6 @@
     //! Used to store the size of each port (may be used in sub-classes).
     TMat&lt;int&gt; port_sizes;
 
-    //! Used to store the description of each port (may be used in
-    //! sub-classes).
-    TVec&lt; TVec&lt;string&gt; &gt; port_descriptions;
-
     // Also used in CostModule for instance
     mutable Vec tmp_input_gradient;
     mutable Mat tmpm_input_gradient;

Modified: trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0/final_learner.psave
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Basic/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:53:08 UTC (rev 7335)
@@ -39,7 +39,7 @@
 destination = &quot;mse.prediction&quot; ;
 propagate_gradient = 1  )
 ] ;
-ports = 8 [ &quot;input&quot; &quot;affine_net.input&quot; &quot;target&quot; &quot;mse.target&quot; &quot;output&quot; &quot;affine_net.output&quot; &quot;cost&quot; &quot;mse.cost&quot; ] ;
+ports = [ &quot;input&quot;:&quot;affine_net.input&quot; &quot;target&quot;:&quot;mse.target&quot; &quot;output&quot;:&quot;affine_net.output&quot; &quot;mse&quot;:&quot;mse.cost&quot; ] ;
 save_states = 1 ;
 name = &quot;NetworkModule&quot; ;
 estimate_simpler_diag_hessian = 0 ;
@@ -47,7 +47,7 @@
 random_gen = *4   )
 ;
 batch_size = 1 ;
-cost_ports = 1 [ &quot;cost&quot; ] ;
+cost_ports = 1 [ &quot;mse&quot; ] ;
 input_ports = 1 [ &quot;input&quot; ] ;
 target_ports = 1 [ &quot;target&quot; ] ;
 weight_ports = []

Modified: trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0/final_learner.psave
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_Greedy/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:53:08 UTC (rev 7335)
@@ -114,7 +114,7 @@
 ] ;
 connections = []
 ;
-ports = 4 [ &quot;input&quot; &quot;rbm_0.visible&quot; &quot;output&quot; &quot;rbm_0.hidden.state&quot; ] ;
+ports = 2 [ (&quot;input&quot; , &quot;rbm_0.visible&quot; )(&quot;output&quot; , &quot;rbm_0.hidden.state&quot; )] ;
 save_states = 1 ;
 name = &quot;network_0&quot; ;
 estimate_simpler_diag_hessian = 0 ;
@@ -214,7 +214,7 @@
 destination = &quot;rbm_1.visible&quot; ;
 propagate_gradient = 0  )
 ] ;
-ports = 4 [ &quot;input&quot; &quot;rbm_0.visible&quot; &quot;output&quot; &quot;rbm_1.hidden.state&quot; ] ;
+ports = 2 [ (&quot;input&quot; , &quot;rbm_0.visible&quot; )(&quot;output&quot; , &quot;rbm_1.hidden.state&quot; )] ;
 save_states = 1 ;
 name = &quot;network_1&quot; ;
 estimate_simpler_diag_hessian = 0 ;
@@ -276,7 +276,7 @@
 destination = &quot;nll.prediction&quot; ;
 propagate_gradient = 1  )
 ] ;
-ports = 8 [ &quot;input&quot; &quot;rbm_0.visible&quot; &quot;output&quot; &quot;affine_net.output&quot; &quot;target&quot; &quot;nll.target&quot; &quot;cost&quot; &quot;nll.cost&quot; ] ;
+ports = 4 [ (&quot;input&quot; , &quot;rbm_0.visible&quot; )(&quot;output&quot; , &quot;affine_net.output&quot; )(&quot;target&quot; , &quot;nll.target&quot; )(&quot;NLL&quot; , &quot;nll.cost&quot; )] ;
 save_states = 1 ;
 name = &quot;network_2&quot; ;
 estimate_simpler_diag_hessian = 0 ;
@@ -293,7 +293,7 @@
 random_gen = *10   )
 ;
 batch_size = 10 ;
-cost_ports = 1 [ &quot;cost&quot; ] ;
+cost_ports = 1 [ &quot;NLL&quot; ] ;
 input_ports = 1 [ &quot;input&quot; ] ;
 target_ports = 1 [ &quot;target&quot; ] ;
 weight_ports = []
@@ -356,7 +356,7 @@
 *31 -&gt;HyperSetOption(
 option_name = &quot;&quot; ;
 option_value = &quot;&quot; ;
-options = 5 [ (&quot;module.forward_to&quot; , &quot;network_2&quot; )(&quot;nstages&quot; , &quot;4000&quot; )(&quot;cost_ports&quot; , &quot;[ \&quot;cost\&quot; ]&quot; )(&quot;target_ports&quot; , &quot;[ \&quot;target\&quot; ]&quot; )(&quot;module.modules[2].modules[1].cd_learning_rate&quot; , &quot;0&quot; )] ;
+options = 5 [ (&quot;module.forward_to&quot; , &quot;network_2&quot; )(&quot;nstages&quot; , &quot;4000&quot; )(&quot;cost_ports&quot; , &quot;[ \&quot;NLL\&quot; ]&quot; )(&quot;target_ports&quot; , &quot;[ \&quot;target\&quot; ]&quot; )(&quot;module.modules[2].modules[1].cd_learning_rate&quot; , &quot;0&quot; )] ;
 call_build = 1  )
 *32 -&gt;HyperRetrain(
 splitter = *0 ;

Modified: trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0/final_learner.psave
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/Split0/final_learner.psave	2007-05-25 14:53:08 UTC (rev 7335)
@@ -1,6 +1,6 @@
 *1 -&gt;ModuleLearner(
 module = *2 -&gt;NetworkModule(
-modules = 7 [ *3 -&gt;RBMModule(
+modules = 8 [ *3 -&gt;RBMModule(
 visible_layer = *4 -&gt;RBMBinomialLayer(
 size = 5 ;
 learning_rate = 0.00100000000000000002 ;
@@ -276,8 +276,7 @@
 estimate_simpler_diag_hessian = 0 ;
 expdir = &quot;&quot; ;
 random_gen = *5   )
-*14 -&gt;CombiningCostsModule(
-sub_costs = 2 [ *15 -&gt;NLLCostModule(
+*14 -&gt;NLLCostModule(
 target_size = 1 ;
 input_size = 2 ;
 output_size = 1 ;
@@ -285,7 +284,7 @@
 estimate_simpler_diag_hessian = 0 ;
 expdir = &quot;&quot; ;
 random_gen = *5   )
-*16 -&gt;ClassErrorCostModule(
+*15 -&gt;ClassErrorCostModule(
 target_size = 1 ;
 input_size = 2 ;
 output_size = 1 ;
@@ -293,24 +292,14 @@
 estimate_simpler_diag_hessian = 0 ;
 expdir = &quot;&quot; ;
 random_gen = *5   )
-] ;
-cost_weights = 2 [ 1 0 ] ;
-n_sub_costs = 2 ;
-target_size = 1 ;
-input_size = 2 ;
-output_size = 3 ;
-name = &quot;costs&quot; ;
-estimate_simpler_diag_hessian = 0 ;
-expdir = &quot;&quot; ;
-random_gen = *5   )
-*17 -&gt;ArgmaxModule(
+*16 -&gt;ArgmaxModule(
 input_size = -1 ;
 output_size = 1 ;
 name = &quot;argmax_class&quot; ;
 estimate_simpler_diag_hessian = 0 ;
 expdir = &quot;&quot; ;
 random_gen = *5   )
-*18 -&gt;SquaredErrorCostModule(
+*17 -&gt;SquaredErrorCostModule(
 target_size = 1 ;
 input_size = 1 ;
 output_size = 1 ;
@@ -319,22 +308,26 @@
 expdir = &quot;&quot; ;
 random_gen = *5   )
 ] ;
-connections = 6 [ *19 -&gt;NetworkConnection(
+connections = 7 [ *18 -&gt;NetworkConnection(
 source = &quot;rbm_1.hidden.state&quot; ;
 destination = &quot;rbm_2.visible&quot; ;
 propagate_gradient = 1  )
-*20 -&gt;NetworkConnection(
+*19 -&gt;NetworkConnection(
 source = &quot;rbm_2.hidden.state&quot; ;
 destination = &quot;affine_net.input&quot; ;
 propagate_gradient = 1  )
-*21 -&gt;NetworkConnection(
+*20 -&gt;NetworkConnection(
 source = &quot;affine_net.output&quot; ;
 destination = &quot;softmax.input&quot; ;
 propagate_gradient = 1  )
-*22 -&gt;NetworkConnection(
+*21 -&gt;NetworkConnection(
 source = &quot;softmax.output&quot; ;
-destination = &quot;costs.prediction&quot; ;
+destination = &quot;nll.prediction&quot; ;
 propagate_gradient = 1  )
+*22 -&gt;NetworkConnection(
+source = &quot;softmax.output&quot; ;
+destination = &quot;class_error.prediction&quot; ;
+propagate_gradient = 0  )
 *23 -&gt;NetworkConnection(
 source = &quot;affine_net.output&quot; ;
 destination = &quot;argmax_class.input&quot; ;
@@ -344,7 +337,7 @@
 destination = &quot;mse.prediction&quot; ;
 propagate_gradient = 0  )
 ] ;
-ports = 12 [ &quot;input&quot; &quot;rbm_1.visible&quot; &quot;target_1&quot; &quot;costs.target&quot; &quot;target_2&quot; &quot;mse.target&quot; &quot;output&quot; &quot;affine_net.output&quot; &quot;cost_1&quot; &quot;costs.cost&quot; &quot;cost_2&quot; &quot;mse.cost&quot; ] ;
+ports = 8 [ (&quot;input&quot; , &quot;rbm_1.visible&quot; )(&quot;&quot; , &quot;nll.target&quot; )(&quot;&quot; , &quot;class_error.target&quot; )(&quot;&quot; , &quot;mse.target&quot; )(&quot;output&quot; , &quot;affine_net.output&quot; )(&quot;NLL&quot; , &quot;nll.cost&quot; )(&quot;class_error&quot; , &quot;class_error.cost&quot; )(&quot;mse&quot; , &quot;mse.cost&quot; )] ;
 save_states = 1 ;
 name = &quot;NetworkModule&quot; ;
 estimate_simpler_diag_hessian = 0 ;
@@ -352,9 +345,9 @@
 random_gen = *5   )
 ;
 batch_size = 11 ;
-cost_ports = 2 [ &quot;cost_1&quot; &quot;cost_2&quot; ] ;
+cost_ports = 3 [ &quot;NLL&quot; &quot;class_error&quot; &quot;mse&quot; ] ;
 input_ports = 1 [ &quot;input&quot; ] ;
-target_ports = 2 [ &quot;target_1&quot; &quot;target_2&quot; ] ;
+target_ports = 3 [ &quot;nll.target&quot; &quot;class_error.target&quot; &quot;mse.target&quot; ] ;
 weight_ports = []
 ;
 mbatch_size = 11 ;

Modified: trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/test_cost_names.txt
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/test_cost_names.txt	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/.pytest/PL_ModuleLearner_TwoRBMs/expected_results/expdir-tester/test_cost_names.txt	2007-05-25 14:53:08 UTC (rev 7335)
@@ -1,4 +1,3 @@
-combined_cost
 NLL
 class_error
 mse

Modified: trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Basic.plearn
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Basic.plearn	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Basic.plearn	2007-05-25 14:53:08 UTC (rev 7335)
@@ -37,13 +37,15 @@
                     ]
 
                     ports = [
-                        &quot;input&quot;     &quot;affine_net.input&quot;
-                        &quot;target&quot;    &quot;mse.target&quot;
-                        &quot;output&quot;    &quot;affine_net.output&quot;
-                        &quot;cost&quot;      &quot;mse.cost&quot;
+                        &quot;input&quot;:&quot;affine_net.input&quot;,
+                        &quot;target&quot;:&quot;mse.target&quot;,
+                        &quot;output&quot;:&quot;affine_net.output&quot;,
+                        &quot;mse&quot;:&quot;mse.cost&quot;
                     ]
                 )
 
+            cost_ports = [ &quot;mse&quot; ]
+            
             batch_size = 1
 
             nstages = ${nstages}

Modified: trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Greedy.pyplearn
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Greedy.pyplearn	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_Greedy.pyplearn	2007-05-25 14:53:08 UTC (rev 7335)
@@ -77,8 +77,8 @@
                     for k in range(i)
                 ],
                 ports = [
-                'input', 'rbm_0.visible',
-                'output', 'rbm_%s.hidden.state' % i
+                    ('input', 'rbm_0.visible'),
+                    ('output', 'rbm_%s.hidden.state' % i)
                 ]))
 
 
@@ -98,10 +98,10 @@
                     connection('softmax.output', 'nll.prediction')
                 ],
             ports = [
-                'input', 'rbm_0.visible',
-                'output', 'affine_net.output',
-                'target', 'nll.target',
-                'cost', 'nll.cost'
+                ('input', 'rbm_0.visible'),
+                ('output', 'affine_net.output'),
+                ('target', 'nll.target'),
+                ('NLL', 'nll.cost')
             ]))
 
 # Module that encapsulates all networks, and forward calls to a single one,
@@ -115,7 +115,8 @@
 
 learner = pl.ModuleLearner(
     module = network,
-    batch_size = batch_size)
+    batch_size = batch_size,
+    cost_ports = [ 'NLL' ])
 
 dataset = pl.AutoVMatrix(
     filename = 'PLEARNDIR:examples/data/test_suite/linear_4x_2y_binary_class.vmat',
@@ -159,7 +160,7 @@
                 options = [
                     ('module.forward_to', 'network_%s' % n_rbms),
                     ('nstages', str(greedy_nstages * n_rbms + fine_tuning_nstages)),
-                    ('cost_ports', '[ &quot;cost&quot; ]'),
+                    ('cost_ports', '[ &quot;NLL&quot; ]'),
                     ('target_ports', '[ &quot;target&quot; ]'),
                     ('module.modules[%s].modules[%s].cd_learning_rate' % (n_rbms, n_rbms-1), '0')
                 ]),

Modified: trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_TwoRBMs.plearn
===================================================================
--- trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_TwoRBMs.plearn	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/plearn_learners/online/test/ModuleLearner/PL_ModuleLearner_TwoRBMs.plearn	2007-05-25 14:53:08 UTC (rev 7335)
@@ -70,22 +70,14 @@
                             output_size = ${n_classes}
                         )
 
-                        CombiningCostsModule( 
-                            name = &quot;costs&quot;
-                            cost_weights = [1 0]
-                            sub_costs = [
+                        NLLCostModule( 
+                            name = &quot;nll&quot;
+                            input_size = ${n_classes}
+                        )
 
-                                NLLCostModule( 
-                                    name = &quot;nll&quot;
-                                    input_size = ${n_classes}
-                                )
-
-                                ClassErrorCostModule(
-                                    name = &quot;class_error&quot;
-                                    input_size = ${n_classes}
-                                )
-
-                            ]
+                        ClassErrorCostModule(
+                            name = &quot;class_error&quot;
+                            input_size = ${n_classes}
                         )
 
                         ArgmaxModule(
@@ -117,10 +109,16 @@
 
                         NetworkConnection( 
                             source = &quot;softmax.output&quot;
-                            destination = &quot;costs.prediction&quot;
+                            destination = &quot;nll.prediction&quot;
                         )
 
                         NetworkConnection( 
+                            source = &quot;softmax.output&quot;
+                            destination = &quot;class_error.prediction&quot;
+                            propagate_gradient = 0
+                        )
+
+                        NetworkConnection( 
                             source = &quot;affine_net.output&quot;
                             destination = &quot;argmax_class.input&quot;
                             propagate_gradient = 0
@@ -134,17 +132,19 @@
                     ]
 
                     ports = [
-                        &quot;input&quot;     &quot;rbm_1.visible&quot;
-                        &quot;target_1&quot;  &quot;costs.target&quot;
-                        &quot;target_2&quot;  &quot;mse.target&quot;
-                        &quot;output&quot;    &quot;affine_net.output&quot;
-                        &quot;cost_1&quot;    &quot;costs.cost&quot;
-                        &quot;cost_2&quot;    &quot;mse.cost&quot;
+                        &quot;input&quot;:&quot;rbm_1.visible&quot;
+                        &quot;&quot;:&quot;nll.target&quot;
+                        &quot;&quot;:&quot;class_error.target&quot;
+                        &quot;&quot;:&quot;mse.target&quot;
+                        &quot;output&quot;:&quot;affine_net.output&quot;
+                        &quot;NLL&quot;:&quot;nll.cost&quot;
+                        &quot;class_error&quot;:&quot;class_error.cost&quot;
+                        &quot;mse&quot;:&quot;mse.cost&quot;
                     ]
                 )
 
-                cost_ports = [ &quot;cost_1&quot; &quot;cost_2&quot; ]
-                target_ports = [ &quot;target_1&quot; &quot;target_2&quot; ]
+                cost_ports = [ &quot;NLL&quot; &quot;class_error&quot; &quot;mse&quot; ]
+                target_ports = [ &quot;nll.target&quot; &quot;class_error.target&quot; &quot;mse.target&quot; ]
 
                 batch_size = ${batch_size}
                 nstages = ${nstages}

Modified: trunk/scripts/Skeletons/OnlineLearningModule.cc
===================================================================
--- trunk/scripts/Skeletons/OnlineLearningModule.cc	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/scripts/Skeletons/OnlineLearningModule.cc	2007-05-25 14:53:08 UTC (rev 7335)
@@ -156,16 +156,6 @@
 }
 */
 
-////////////////////////
-// getPortDescription //
-////////////////////////
-/* OPTIONAL
-// The default implementation is probably appropriate
-TVec&lt;string&gt; DERIVEDCLASS::getPortDescription(const string&amp; port)
-{
-} 
-*/
-
 //////////////
 // getPorts //
 //////////////

Modified: trunk/scripts/Skeletons/OnlineLearningModule.h
===================================================================
--- trunk/scripts/Skeletons/OnlineLearningModule.h	2007-05-25 14:52:22 UTC (rev 7334)
+++ trunk/scripts/Skeletons/OnlineLearningModule.h	2007-05-25 14:53:08 UTC (rev 7335)
@@ -200,13 +200,6 @@
     //!         - 'input_size' for the first row and 'output_size' for the
     //!           second row if nPorts() &gt;= 2
     virtual const TMat&lt;int&gt;&amp; getPortSizes();
-
-    //! Return a list of strings, that represents the description of the values
-    //! taken by a given port: the i-th string is the name for the i-th column
-    //! value computed in 'port'.
-    //! The default version returns [ &quot;port_name_1&quot;, ..., &quot;port_name_n&quot; ] where
-    //! 'port_name' is the name of the port, and 'n' its size.
-    virtual TVec&lt;string&gt; getPortDescription(const string&amp; port);
     */
 
     //#####  PLearn::Object Protocol  #########################################


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000783.html">[Plearn-commits] r7334 - trunk/python_modules/plearn/pymake
</A></li>
	<LI>Next message: <A HREF="000785.html">[Plearn-commits] r7336 - trunk/plearn_learners/online
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#784">[ date ]</a>
              <a href="thread.html#784">[ thread ]</a>
              <a href="subject.html#784">[ subject ]</a>
              <a href="author.html#784">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
