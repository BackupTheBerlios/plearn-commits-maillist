<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r7071 - trunk/python_modules/plearn/parallel
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7071%20-%20trunk/python_modules/plearn/parallel&In-Reply-To=%3C200705121824.l4CIOkns024718%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000519.html">
   <LINK REL="Next"  HREF="000521.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r7071 - trunk/python_modules/plearn/parallel</H1>
    <B>nouiz at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7071%20-%20trunk/python_modules/plearn/parallel&In-Reply-To=%3C200705121824.l4CIOkns024718%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r7071 - trunk/python_modules/plearn/parallel">nouiz at mail.berlios.de
       </A><BR>
    <I>Sat May 12 20:24:46 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000519.html">[Plearn-commits] r7070 - trunk/python_modules/plearn/pytest
</A></li>
        <LI>Next message: <A HREF="000521.html">[Plearn-commits] r7072 - trunk/plearn_learners/online
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#520">[ date ]</a>
              <a href="thread.html#520">[ thread ]</a>
              <a href="subject.html#520">[ subject ]</a>
              <a href="author.html#520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: nouiz
Date: 2007-05-12 20:24:46 +0200 (Sat, 12 May 2007)
New Revision: 7071

Modified:
   trunk/python_modules/plearn/parallel/dbi.py
Log:
Fixed a bug that made utils.py do not work.


Modified: trunk/python_modules/plearn/parallel/dbi.py
===================================================================
--- trunk/python_modules/plearn/parallel/dbi.py	2007-05-11 23:34:42 UTC (rev 7070)
+++ trunk/python_modules/plearn/parallel/dbi.py	2007-05-12 18:24:46 UTC (rev 7071)
@@ -53,7 +53,7 @@
 
         # the default directory where file generated by dbi will be stored
         # It should not take the &quot;&quot; or &quot; &quot; value. Use &quot;.&quot; instead.
-        self.tmp_dir = 'TMP_CDISPATCH'
+        self.tmp_dir = 'TMP_DBI'
 
         #
         self.file_redirect_stdout = 0
@@ -85,7 +85,7 @@
 
 class Task:
 
-    def __init__(self, command, log_dir, time_format, pre_tasks=[], post_tasks=[], args = {}):
+    def __init__(self, command, tmp_dir, log_dir, time_format, pre_tasks=[], post_tasks=[], args = {}):
         self.unique_id = get_new_sid('')
         self.add_unique_id = 0
         formatted_command = re.sub( '[^a-zA-Z0-9]', '_', command );
@@ -97,8 +97,9 @@
         # the command itself. Therefore, no need for pre- and post-commands in
         # the Task class
 
+        utils_file = os.path.join(tmp_dir, 'utils.py')
+        utils_file = os.path.abspath(utils_file)
 
-
         for key in args.keys():
             self.__dict__[key] = args[key]
 
@@ -113,10 +114,11 @@
         if len(pre_tasks) &gt; 0:
             self.commands.extend( pre_tasks )
 #        self.commands.append(&quot;cd parent&quot;)
-        self.commands.append(&quot;./utils.py &quot; + 'set_config_value '+
+
+        self.commands.append(utils_file + ' set_config_value '+
                 string.join([self.log_file,'STATUS',str(STATUS_RUNNING)],' '))
         # set the current date in the field LAUNCH_TIME
-        self.commands.append(&quot;./utils.py &quot; + 'set_current_date '+
+        self.commands.append(utils_file +  ' set_current_date '+
                 string.join([self.log_file,'LAUNCH_TIME',time_format],' '))
 
         #cd to parent diectory, run the command, and then cd back
@@ -124,10 +126,10 @@
         self.commands.append( command )
         self.commands.extend( post_tasks )
 
-        self.commands.append(&quot;./utils.py &quot; + 'set_config_value '+
+        self.commands.append(utils_file + ' set_config_value '+
                 string.join([self.log_file,'STATUS',str(STATUS_FINISHED)],' '))
         # set the current date in the field FINISHED_TIME
-        self.commands.append(&quot;./utils.py &quot; + 'set_current_date ' +
+        self.commands.append(utils_file + ' set_current_date ' +
                 string.join([self.log_file,'FINISHED_TIME',time_format],' '))
 #     self.commands.append(&quot;cd parent&quot;)
 
@@ -196,8 +198,9 @@
 
         # create the information about the tasks
         for command in commands:
-            self.tasks.append(Task(command, self.log_dir, self.time_format,
-                                   self.pre_tasks, self.post_tasks))
+            self.tasks.append(Task(command, self.tmp_dir, self.log_dir,
+                                   self.time_format,self.pre_tasks,
+                                   self.post_tasks))
 
 
     def run_one_job(self, task):
@@ -270,8 +273,10 @@
         # create the information about the tasks
         args['temp_dir'] = self.temp_dir
         for command in commands:
-            self.tasks.append(Task(command, self.log_dir, self.time_format,
-                                   [self.pre_tasks,'cd parent;'], self.post_tasks,args))
+            self.tasks.append(Task(command, self.tmp_dir, self.log_dir,
+                                   self.time_format,
+                                   [self.pre_tasks, 'cd parent;'],
+                                   self.post_tasks,args))
 
 
     def run(self):
@@ -420,8 +425,9 @@
             elif not os.access(c, os.X_OK):
                 raise Exception(&quot;The command '&quot;+c+&quot;' do not have execution permission!&quot;)
 
-            self.tasks.append(Task(newcommand, self.log_dir, self.time_format,
-                                   self.pre_tasks, self.post_tasks,args))
+            self.tasks.append(Task(newcommand, self.tmp_dir, self.log_dir,
+                                   self.time_format, self.pre_tasks,
+                                   self.post_tasks,args))
 
             #keeps a list of the temporary files created, so that they can be deleted at will            
         self.temp_files = []
@@ -500,7 +506,7 @@
             self.temp_files.append(utils_file)
             os.chmod(utils_file, 0755)
 
-        configobj_file = os.path.join(self.tmp_dir, 'utils.py')
+        configobj_file = os.path.join(self.tmp_dir, 'configobj.py')
         if not os.path.exists('configobj.py'):
             shutil.copy( get_plearndir()+
                          '/python_modules/plearn/parallel/configobj.py',  configobj_file)
@@ -605,8 +611,9 @@
 
         # create the information about the tasks
         for command in commands:
-            self.tasks.append(Task(command, self.log_dir, self.time_format,
-                                   self.pre_tasks, self.post_tasks))
+            self.tasks.append(Task(command, self.tmp_dir, self.log_dir,
+                                   self.time_format, self.pre_tasks,
+                                   self.post_tasks))
         self.hosts= find_all_ssh_hosts()
         
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000519.html">[Plearn-commits] r7070 - trunk/python_modules/plearn/pytest
</A></li>
	<LI>Next message: <A HREF="000521.html">[Plearn-commits] r7072 - trunk/plearn_learners/online
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#520">[ date ]</a>
              <a href="thread.html#520">[ thread ]</a>
              <a href="subject.html#520">[ subject ]</a>
              <a href="author.html#520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
