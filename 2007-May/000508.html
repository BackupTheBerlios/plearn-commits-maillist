<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r7059 - trunk/python_modules/plearn/parallel
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7059%20-%20trunk/python_modules/plearn/parallel&In-Reply-To=%3C200705111421.l4BEL367019598%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000507.html">
   <LINK REL="Next"  HREF="000509.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r7059 - trunk/python_modules/plearn/parallel</H1>
    <B>nouiz at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r7059%20-%20trunk/python_modules/plearn/parallel&In-Reply-To=%3C200705111421.l4BEL367019598%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r7059 - trunk/python_modules/plearn/parallel">nouiz at mail.berlios.de
       </A><BR>
    <I>Fri May 11 16:21:03 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000507.html">[Plearn-commits] r7058 - trunk
</A></li>
        <LI>Next message: <A HREF="000509.html">[Plearn-commits] r7060 - trunk/plearn_learners/online/EXPERIMENTAL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#508">[ date ]</a>
              <a href="thread.html#508">[ thread ]</a>
              <a href="subject.html#508">[ subject ]</a>
              <a href="author.html#508">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: nouiz
Date: 2007-05-11 16:21:02 +0200 (Fri, 11 May 2007)
New Revision: 7059

Modified:
   trunk/python_modules/plearn/parallel/dbi.py
Log:
All file created are put in a folder for condor
Raise an exception if the executable do not exist for condor
Print the condor_submit command that are executed 


Modified: trunk/python_modules/plearn/parallel/dbi.py
===================================================================
--- trunk/python_modules/plearn/parallel/dbi.py	2007-05-11 13:55:48 UTC (rev 7058)
+++ trunk/python_modules/plearn/parallel/dbi.py	2007-05-11 14:21:02 UTC (rev 7059)
@@ -51,6 +51,10 @@
         self.log_dir = 'LOGS'
         self.log_file = os.path.join( self.log_dir, self.unique_id )
 
+        # the default directory where file generated by dbi will be stored
+        # It should not take the &quot;&quot; or &quot; &quot; value. Use &quot;.&quot; instead.
+        self.tmp_dir = 'TMP_CDISPATCH'
+
         #
         self.file_redirect_stdout = 0
         self.file_redirect_stderr = 0
@@ -353,6 +357,9 @@
         if not os.path.exists(self.log_dir):
             os.mkdir(self.log_dir)
 
+        if not os.path.exists(self.tmp_dir):
+            os.mkdir(self.tmp_dir)
+            
 #        self.log_file = os.path.join( self.parent_dir, self.log_file )
 
         # create the information about the tasks
@@ -387,14 +394,19 @@
                 newcommand+='  '+c+'.32'+c2+'\n'
                 newcommand+='else\n'
                 newcommand+='  '+c+&quot;.64&quot;+c2+'\nfi'
+                if not os.access(c+&quot;.64&quot;, os.X_OK):
+                    raise Exception(&quot;The command '&quot;+c+&quot;.64' do not have execution permission!&quot;)
+                c+=&quot;.32&quot;
             elif self.cplat==&quot;INTEL&quot; and os.path.exists(c+&quot;.32&quot;):
                 self.targetcondorplatform='INTEL'
                 self.targetplatform='linux-i386'
-                newcommand=c+&quot;.32&quot;+c2
+                c+=&quot;.32&quot;
+                newcommand=c+c2
             elif self.cplat==&quot;X86_64&quot; and os.path.exists(c+&quot;.64&quot;):
                 self.targetcondorplatform='X86_64'
                 self.targetplatform='linux-x86_64'
-                newcommand=c+&quot;.64&quot;+c2
+                c+=&quot;.64&quot;
+                newcommand=c+c2
             else:
                 self.targetcondorplatform=self.cplat
                 if self.cplat=='INTEL':
@@ -403,6 +415,11 @@
                     self.targetplatform='linux-x86_64'
                 newcommand=command
             
+            if not os.path.exists(c):
+                raise Exception(&quot;The command '&quot;+c+&quot;' do not exist!&quot;)
+            elif not os.access(c, os.X_OK):
+                raise Exception(&quot;The command '&quot;+c+&quot;' do not have execution permission!&quot;)
+
             self.tasks.append(Task(newcommand, self.log_dir, self.time_format,
                                    self.pre_tasks, self.post_tasks,args))
 
@@ -413,7 +430,7 @@
         
         # create the bqsubmit.dat, with
 
-        condor_data = task.unique_id + '.data'
+        condor_data = os.path.join(self.tmp_dir, task.unique_id + '.data')
         self.temp_files.append(condor_data)
         param_dat = open(condor_data, 'w')
 
@@ -423,7 +440,7 @@
         param_dat.close()
         
 
-        condor_file = task.unique_id + &quot;.condor&quot;
+        condor_file = os.path.join(self.tmp_dir, task.unique_id + &quot;.condor&quot;)
         self.temp_files.append(condor_file)
         condor_dat = open( condor_file, 'w' )
 
@@ -439,7 +456,7 @@
             tcplat2=&quot;X86_64&quot;
         tplat=self.targetplatform
         condor_dat.write( dedent('''\
-                executable     = ./launch.sh
+                executable     = %s/launch.sh
                 arguments      = sh %s $$(Arch) 
                 universe       = vanilla
                 requirements   = (Arch == &quot;%s&quot;)||(Arch == &quot;%s&quot;)  
@@ -451,16 +468,17 @@
                 PYTHONPATH=/cluster/diro/home/lisa/local/%s/lib/python2.4/site-packages:/cluster/diro/home/lisa/local/%s/lib/python2.3/site-packages:/cluster/diro/home/lisa/local/%s/lib/python2.2/site-packages:/cluster/diro/home/lisa/local/%s/lib/python2.4/site-packages/vtk_python:/cluster/diro/home/lisa/local/%s/lib/python2.3/site-packages/Numeric:/u/%s/PLearn/python_modules:/u/%s/projects/apstatsoft/python_modules:/u/%s/PLearn/python_modules;
                 #getenv         = True
                 queue
-                ''' % (condor_data, tcplat1,tcplat2,tcplat1,task.unique_id,tcplat1,task.unique_id,tcplat1,get_hostname(),'linux-x86_64','linux-x86_64','linux-x86_64','linux-i386','linux-i386','linux-i386',tplat,u,u,u,u,u,u,tplat,tplat,tplat,tplat,tplat,u,u,u)) )
+                ''' % (self.tmp_dir,condor_data, tcplat1,tcplat2,tcplat1,task.unique_id,tcplat1,task.unique_id,tcplat1,get_hostname(),'linux-x86_64','linux-x86_64','linux-x86_64','linux-i386','linux-i386','linux-i386',tplat,u,u,u,u,u,u,tplat,tplat,tplat,tplat,tplat,u,u,u)) )
 #                preBatch = ''' + pre_batch_command + '''
 #                postBatch = ''' + post_batch_command +'''
         condor_dat.close()
                 #environment    = LD_LIBRARY_PATH=/u/lisa/local/byhost/%s/lib:/u/lisa/local/%s/lib:/cluster/diro/home/lisa/local/%s/lib/python2.4/site-packages/numarray:/cluster/diro/home/lisa/local/%s/lib:/usr/local/lib:/cluster/diro/home/lisa/local/%s/lib32:/soft/lisa/linux/lib;PATH=/cluster/diro/home/lisa/PLearn/scripts:/soft/lisa/linux/bin:/u/lisa/local/%s/bin:/u/%s/PLearn/commands:/u/%s/PLearn/scripts:/Scripts:/commands:/u/%s/Scripts:/soft/diro/share/moe/bin-i4lx:/u/lamblinp/code/usr/bin:/u/%s/PLearn:/u/%s/PLearn/scripts:/u/%s/PLearn/commands:/u/%s/projects/apstatsoft:/u/%s/projects/apstatsoft/scripts:/u/%s/projects/apstatsoft/commands:/usr/kerberos/bin:/u/%s/GNUstep/Tools:/usr/GNUstep/Local/Tools:/usr/GNUstep/System/Tools:/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/opt/diro/bin:/u/lisa/local/linux-i386/bin;PYTHONPATH=/cluster/diro/home/lisa/PLearn/python_modules:/cluster/diro/home/lisa/local/%s/lib/python2.4/site-packages:/u/lisa/local/%s/lib/python2.3/site-packages:!
 /u/lisa/local/%s/lib/python2.2/site-packages:/u/lisa/local/%s/lib/python2.4/site-packages/vtk_python:/u/lisa/local/%s/lib/python2.3/site-packages/Numeric:/u/%s/PLearn/python_modules:/u/%s/projects/apstatsoft/python_modules:
 
-        if not os.path.exists('launch.sh'):
-            self.temp_files.append('launch.sh')
-            launch_file = open('launch.sh','w')
-            launch_file.write(dedent('''\
+        launch_file = os.path.join(self.tmp_dir, 'launch.sh')
+        if not os.path.exists(launch_file):
+            self.temp_files.append(launch_file)
+            launch_dat = open(launch_file,'w')
+            launch_dat.write(dedent('''\
             #!/bin/sh
             PROGRAM=$1
             shift
@@ -472,18 +490,22 @@
             which python            
             echo ${PROGRAM} $@
             $PROGRAM $@'''))
-            launch_file.close()
-            os.chmod('launch.sh',0755)
+            launch_dat.close()
+            os.chmod(launch_file, 0755)
 
-        if not os.path.exists('utils.py'):
+        utils_file = os.path.join(self.tmp_dir, 'utils.py')
+        if not os.path.exists(utils_file):
             shutil.copy( get_plearndir()+
-                         '/python_modules/plearn/parallel/utils.py', '.')
-            os.chmod('utils.py',0755)
+                         '/python_modules/plearn/parallel/utils.py', utils_file)
+            self.temp_files.append(utils_file)
+            os.chmod(utils_file, 0755)
 
+        configobj_file = os.path.join(self.tmp_dir, 'utils.py')
         if not os.path.exists('configobj.py'):
             shutil.copy( get_plearndir()+
-                         '/python_modules/plearn/parallel/configobj.py', '.')
-            os.chmod('configobj.py',0755)
+                         '/python_modules/plearn/parallel/configobj.py',  configobj_file)
+            self.temp_files.append(configobj_file)            
+            os.chmod(configobj_file, 0755)
                                     
         # Launch bqsubmit
         output = PIPE
@@ -492,6 +514,7 @@
             output = file(self.log_file + '.out', 'w')
         if int(self.file_redirect_stderr):
             error = file(self.log_file + '.err', 'w')
+        print &quot;Executing: condor_submit &quot; + condor_file
         self.p = Popen( 'condor_submit '+ condor_file, shell=True , stdout=output, stderr=error)
 
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000507.html">[Plearn-commits] r7058 - trunk
</A></li>
	<LI>Next message: <A HREF="000509.html">[Plearn-commits] r7060 - trunk/plearn_learners/online/EXPERIMENTAL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#508">[ date ]</a>
              <a href="thread.html#508">[ thread ]</a>
              <a href="subject.html#508">[ subject ]</a>
              <a href="author.html#508">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
