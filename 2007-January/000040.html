<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r6591 - in trunk/python_modules/plearn/math/stats:	. .pytest .pytest/PL_cvx_numarray_matrix_conversions	.pytest/PL_cvx_numarray_matrix_conversions/expected_results
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-January/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6591%20-%20in%20trunk/python_modules/plearn/math/stats%3A%0A%09.%20.pytest%20.pytest/PL_cvx_numarray_matrix_conversions%0A%09.pytest/PL_cvx_numarray_matrix_conversions/expected_results&In-Reply-To=%3C200701220350.l0M3oGwq031702%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000039.html">
   <LINK REL="Next"  HREF="000041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r6591 - in trunk/python_modules/plearn/math/stats:	. .pytest .pytest/PL_cvx_numarray_matrix_conversions	.pytest/PL_cvx_numarray_matrix_conversions/expected_results</H1>
    <B>dorionc at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6591%20-%20in%20trunk/python_modules/plearn/math/stats%3A%0A%09.%20.pytest%20.pytest/PL_cvx_numarray_matrix_conversions%0A%09.pytest/PL_cvx_numarray_matrix_conversions/expected_results&In-Reply-To=%3C200701220350.l0M3oGwq031702%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r6591 - in trunk/python_modules/plearn/math/stats:	. .pytest .pytest/PL_cvx_numarray_matrix_conversions	.pytest/PL_cvx_numarray_matrix_conversions/expected_results">dorionc at mail.berlios.de
       </A><BR>
    <I>Mon Jan 22 04:50:16 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000039.html">[Plearn-commits] r6590 - trunk/doc
</A></li>
        <LI>Next message: <A HREF="000041.html">[Plearn-commits] r6592 - trunk/plearn_learners/testers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40">[ date ]</a>
              <a href="thread.html#40">[ thread ]</a>
              <a href="subject.html#40">[ subject ]</a>
              <a href="author.html#40">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: dorionc
Date: 2007-01-22 04:50:16 +0100 (Mon, 22 Jan 2007)
New Revision: 6591

Added:
   trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/
   trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/expected_results/
   trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/expected_results/RUN.log
Modified:
   trunk/python_modules/plearn/math/stats/__init__.py
   trunk/python_modules/plearn/math/stats/cvx_utils.py
   trunk/python_modules/plearn/math/stats/pytest.config
Log:
Added conversions and tests for NumArray



Property changes on: trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions
___________________________________________________________________
Name: svn:ignore
   + .plearn
run_results


Added: trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/expected_results/RUN.log
===================================================================
--- trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/expected_results/RUN.log	2007-01-20 00:05:13 UTC (rev 6590)
+++ trunk/python_modules/plearn/math/stats/.pytest/PL_cvx_numarray_matrix_conversions/expected_results/RUN.log	2007-01-22 03:50:16 UTC (rev 6591)
@@ -0,0 +1,56 @@
+-------------------------------------------------------------------------------- 
+Test Case 1
+--------------------------------------------------------------------------------
+NumArray matrix shaped (10,)
+[ 1  2  3  4  5  6  7  8  9 10]
+CVX matrix shaped (1, 10)
+   1.0000e+00   2.0000e+00   3.0000e+00   4.0000e+00   5.0000e+00   6.0000e+00   7.0000e+00   8.0000e+00   9.0000e+00   1.0000e+01
+
+
+-------------------------------------------------------------------------------- 
+Test Case 2
+--------------------------------------------------------------------------------
+NumArray matrix shaped (1, 10)
+[[ 1  2  3  4  5  6  7  8  9 10]]
+CVX matrix shaped (1, 10)
+   1.0000e+00   2.0000e+00   3.0000e+00   4.0000e+00   5.0000e+00   6.0000e+00   7.0000e+00   8.0000e+00   9.0000e+00   1.0000e+01
+
+
+-------------------------------------------------------------------------------- 
+Test Case 3
+--------------------------------------------------------------------------------
+NumArray matrix shaped (10, 1)
+[[ 1]
+ [ 2]
+ [ 3]
+ [ 4]
+ [ 5]
+ [ 6]
+ [ 7]
+ [ 8]
+ [ 9]
+ [10]]
+CVX matrix shaped (10, 1)
+   1.0000e+00
+   2.0000e+00
+   3.0000e+00
+   4.0000e+00
+   5.0000e+00
+   6.0000e+00
+   7.0000e+00
+   8.0000e+00
+   9.0000e+00
+   1.0000e+01
+
+
+-------------------------------------------------------------------------------- 
+Test Case 4
+--------------------------------------------------------------------------------
+NumArray matrix shaped (2, 10)
+[[ 1  2  3  4  5  6  7  8  9 10]
+ [11 12 13 14 15 16 17 18 19 20]]
+CVX matrix shaped (2, 10)
+   1.0000e+00   2.0000e+00   3.0000e+00   4.0000e+00   5.0000e+00   6.0000e+00   7.0000e+00   8.0000e+00   9.0000e+00   1.0000e+01
+   1.1000e+01   1.2000e+01   1.3000e+01   1.4000e+01   1.5000e+01   1.6000e+01   1.7000e+01   1.8000e+01   1.9000e+01   2.0000e+01
+
+

Modified: trunk/python_modules/plearn/math/stats/__init__.py
===================================================================
--- trunk/python_modules/plearn/math/stats/__init__.py	2007-01-20 00:05:13 UTC (rev 6590)
+++ trunk/python_modules/plearn/math/stats/__init__.py	2007-01-22 03:50:16 UTC (rev 6591)
@@ -1,3 +1,36 @@
+# stats/__init__.py
+# Copyright (C) 2007 Christian Dorion
+#
+#  Redistribution and use in source and binary forms, with or without
+#  modification, are permitted provided that the following conditions are met:
+#
+#   1. Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#
+#   2. Redistributions in binary form must reproduce the above copyright
+#      notice, this list of conditions and the following disclaimer in the
+#      documentation and/or other materials provided with the distribution.
+#
+#   3. The name of the authors may not be used to endorse or promote
+#      products derived from this software without specific prior written
+#      permission.
+#
+#  THIS SOFTWARE IS PROVIDED BY THE AUTHORS ``AS IS'' AND ANY EXPRESS OR
+#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+#  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN
+#  NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
+#  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
+#  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
+#  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+#  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+#  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+#  This file is part of the PLearn library. For more information on the PLearn
+#  library, go to the PLearn Web site at www.plearn.org
+
+
+# Author: Christian Dorion
 &quot;&quot;&quot;UNDER DEVELOPMENT!
 
 This package is meant to bundle statistical tools relying on RPy whenever

Modified: trunk/python_modules/plearn/math/stats/cvx_utils.py
===================================================================
--- trunk/python_modules/plearn/math/stats/cvx_utils.py	2007-01-20 00:05:13 UTC (rev 6590)
+++ trunk/python_modules/plearn/math/stats/cvx_utils.py	2007-01-22 03:50:16 UTC (rev 6591)
@@ -1,19 +1,97 @@
-&quot;&quot;&quot;Provides functions to use CVX transparently where NumPy is the standard.&quot;&quot;&quot;
+# cvx_utils.py
+# Copyright (C) 2007 Christian Dorion
+#
+#  Redistribution and use in source and binary forms, with or without
+#  modification, are permitted provided that the following conditions are met:
+#
+#   1. Redistributions of source code must retain the above copyright
+#      notice, this list of conditions and the following disclaimer.
+#
+#   2. Redistributions in binary form must reproduce the above copyright
+#      notice, this list of conditions and the following disclaimer in the
+#      documentation and/or other materials provided with the distribution.
+#
+#   3. The name of the authors may not be used to endorse or promote
+#      products derived from this software without specific prior written
+#      permission.
+#
+#  THIS SOFTWARE IS PROVIDED BY THE AUTHORS ``AS IS'' AND ANY EXPRESS OR
+#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+#  OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN
+#  NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+#  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
+#  TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
+#  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
+#  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+#  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+#  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+#
+#  This file is part of the PLearn library. For more information on the PLearn
+#  library, go to the PLearn Web site at www.plearn.org
+
+
+# Author: Christian Dorion
+&quot;&quot;&quot;Provides functions to use CVX transparently where NumPy or NumArray is the standard.&quot;&quot;&quot;
 import numpy
-from cvxopt.base import matrix, spmatrix, log
+import numarray 
+from cvxopt import base as cvx
 
+
+#####  NumArray vs CVX  #####################################################
+
+def numarray_asmatrix(a):
+    if len(a.shape) == 1:
+        return numarray.array([ a ]) # One row matrix
+    elif len(a.shape) == 2:
+        return a
+    raise ValueError, a
+
+def numarray_to_cvx(*args):
+    &quot;&quot;&quot;Returns CVX matrices from NumArray matrices
+
+    Note that NumArray one-dimensional arrays are transformed as row vectors
+    in CVX. See/Run test_numarray_cvx_conversions() for details.
+    &quot;&quot;&quot;
+    matrices = []
+    for a in args:
+        a    = numarray_asmatrix(a)
+        m, n = a.shape
+        a    = numarray.ravel( numarray.transpose(a) )
+        matrices.append( cvx.matrix(a, (m,n), 'd') )
+
+    if len(matrices)==1:
+        return matrices[0]
+    return matrices
+
+def cvx_to_numarray(*args):
+    &quot;&quot;&quot;Returns NumArray matrices from CVX matrices
+
+    Note that CVX vectors are returns as one-dimensional NumArray
+    matrices. See/Run test_numarray_cvx_conversions() for details.
+    &quot;&quot;&quot;
+    matrices = []
+    for a in args:
+        matrices.append( numarray.array(a) )
+
+    if len(matrices)==1:
+        return matrices[0]
+    return matrices
+
+
+#####  NumPy vs CVX  ########################################################
+
 def numpy_to_cvx(*args):
     &quot;&quot;&quot;Returns CVX matrices from NumPy matrices
 
     Note that NumPy one-dimensional arrays are transformed as row vectors
-    in CVX. See/Run test_matrix_conversions() for details.
+    in CVX. See/Run test_numpy_cvx_conversions() for details.
     &quot;&quot;&quot;
     matrices = []
     for a in args:
         a    = numpy.asmatrix(a)
         m, n = a.shape
         a    = numpy.ravel(a.transpose())
-        matrices.append( matrix(a, (m,n), 'd') )
+        matrices.append( cvx.matrix(a, (m,n), 'd') )
 
     if len(matrices)==1:
         return matrices[0]
@@ -23,7 +101,7 @@
     &quot;&quot;&quot;Returns NumPy matrices from CVX matrices
 
     Note that CVX vectors are returns as one-dimensional NumPy
-    matrices. See/Run test_matrix_conversions() for details.
+    matrices. See/Run test_numpy_cvx_conversions() for details.
     &quot;&quot;&quot;
     matrices = []
     for a in args:
@@ -34,9 +112,121 @@
     return matrices
 
 
+#####  Numerical Derivatives  ###############################################
+
+def numerical_gradient(x_k, func, epsilon, *args):
+    n_params, one = x_k.size
+    assert one==1
+    
+    ei = cvx.matrix(0.0, x_k.size)
+    grad = cvx.matrix(0.0, x_k.size)
+    for i in range(n_params):
+        ei[i]   = epsilon
+        grad[i] = ( func(x_k+ei, *args) - func(x_k-ei, *args) ) / (2*epsilon)
+        ei[i]   = 0.0
+    return grad.T
+
+def numerical_hessian(x_k, f_k, func, epsilon, *args):
+    n_params, one = x_k.size
+    assert one==1
+    H = cvx.matrix(0.0, (n_params,n_params))
+    epsilon2 = epsilon**2
+    
+    ei = cvx.matrix(0.0, x_k.size)
+    esame = cvx.matrix(0.0, x_k.size)
+    ecross = cvx.matrix(0.0, x_k.size)
+    for i in range(n_params):
+        esame[i], ecross[i] = +epsilon, +epsilon
+        for j in range(i):            
+            esame[j], ecross[j] = +epsilon, -epsilon
+
+            lhs = func(x_k+esame, *args) - func(x_k+ecross, *args)
+            rhs = func(x_k-ecross, *args) - func(x_k-esame, *args)            
+            H[i,j] = (lhs - rhs) / (4*epsilon2)
+            H[j,i] = H[i,j]
+
+            esame[j], ecross[j] = 0.0, 0.0
+        esame[i], ecross[i] = 0.0, 0.0
+                
+        ei[i] = epsilon        
+        H[i,i] = (func(x_k+ei, *args) + func(x_k-ei, *args) - 2*f_k) / epsilon2        
+        ei[i] = 0.0        
+
+    return H
+
+def use_numerical_derivatives_nc(objective, starting_values, epsilon):
+    &quot;&quot;&quot;NC stands for 'no nonlinear constraints'&quot;&quot;&quot;
+    def _using_numerical_derivatives(params=None, z=None):
+        # Access pattern for starting values
+        if params is None:
+            return 0, starting_values
+
+        # If objective returns None, this function shall return
+        OBJ = objective(params)
+        if OBJ is None: return None
+        
+        # Compute numerical gradient
+        OBJ_D = numerical_gradient(params, objective, epsilon)
+        if z is None:
+            return cvx.matrix(OBJ, (1,1)), OBJ_D
+
+        # Compute the numerical Hessian
+        assert z.size==(1,1)
+        OBJ_H = z[0,0]*numerical_hessian(params, OBJ, objective, epsilon)
+        return cvx.matrix(OBJ, (1,1)), OBJ_D, OBJ_H
+
+    def using_numerical_derivatives(params=None, z=None):
+        out = _using_numerical_derivatives(params, z)
+        print &quot;OUT&quot;,
+        for o in out:
+            print o
+        if len(out)==3:
+            from cvxopt.lapack import syev
+            W = cvx.matrix(0.0, (6,1), 'd')
+            syev(out[-1], W)
+            print &quot;EIGEN&quot;, W
+        return out
+        
+    return using_numerical_derivatives
+
+
 #####  Builtin Tests  #######################################################
 
-def test_matrix_conversions():
+def test_numarray_cvx_conversions():
+    _1_10_ = numarray.array( range(1,11) )
+    test_cases = [
+        _1_10_,
+        numarray.array([ _1_10_ ]),
+        numarray.transpose( numarray.array([ _1_10_ ]) ),        
+        numarray.array([ _1_10_, range(11, 21) ])
+        ]
+
+    for t, a in enumerate(test_cases):
+        print &quot;-&quot;*80, '\nTest Case %d\n'%(t+1), &quot;-&quot;*80        
+        print &quot;NumArray matrix shaped&quot;, a.shape
+        print a
+        
+        a_cvx = numarray_to_cvx(a)
+        print &quot;CVX matrix shaped&quot;, a_cvx.size
+        print a_cvx
+
+        a = numarray_asmatrix(a)
+        a_numarray = cvx_to_numarray(a_cvx)
+        m, n = a.shape
+        assert (m,n)==a_cvx.size, \
+               &quot;(m,n) = (%d,%d) != %s = a_cvx.size&quot;%(m, n, a_cvx.size)
+        assert (m,n)==a_numarray.shape, \
+               &quot;(m,n) = (%d,%d) != %s = a_numarray.size&quot;%(m, n, a_numarray.shape)
+
+        for i in range(m):
+            for j in range(n):
+                assert a[i,j] == a_cvx[i,j], &quot;a[%d,%d] = %f != %f = a_cvx[%d,%d]&quot;%(
+                    i, j, a[i,j], a_cvx[i,j], i, j )
+                assert a[i,j] == a_numarray[i,j], &quot;a[%d,%d] = %f != %f = a_numarray[%d,%d]&quot;%(
+                    i, j, a[i,j], a_numarray[i,j], i, j )
+        print
+
+def test_numpy_cvx_conversions():
     _1_10_ = numpy.array( range(1,11) ) 
     test_cases = [
         _1_10_,
@@ -71,4 +261,4 @@
         print
 
 if __name__ == &quot;__main__&quot;:
-    test_matrix_conversions()
+    test_numarray_cvx_conversions()

Modified: trunk/python_modules/plearn/math/stats/pytest.config
===================================================================
--- trunk/python_modules/plearn/math/stats/pytest.config	2007-01-20 00:05:13 UTC (rev 6590)
+++ trunk/python_modules/plearn/math/stats/pytest.config	2007-01-22 03:50:16 UTC (rev 6591)
@@ -93,11 +93,23 @@
     
 &quot;&quot;&quot;
 Test(
+    name = &quot;PL_cvx_numarray_matrix_conversions&quot;,
+    description = &quot;&quot;,
+    category = &quot;General&quot;,
+    program = Program(name = &quot;python&quot;),
+    arguments = &quot;-c 'from plearn.math.stats.cvx_utils import *; test_numarray_cvx_conversions()'&quot;,
+    resources = [ ],
+    precision = 1e-06,
+    pfileprg = None,
+    disabled = False
+    )
+
+Test(
     name = &quot;PL_cvx_numpy_matrix_conversions&quot;,
     description = &quot;&quot;,
     category = &quot;General&quot;,
     program = Program(name = &quot;python&quot;),
-    arguments = &quot;-c 'from plearn.math.stats.cvx_utils import *; test_matrix_conversions()'&quot;,
+    arguments = &quot;-c 'from plearn.math.stats.cvx_utils import *; test_numpy_cvx_conversions()'&quot;,
     resources = [ ],
     precision = 1e-06,
     pfileprg = None,


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000039.html">[Plearn-commits] r6590 - trunk/doc
</A></li>
	<LI>Next message: <A HREF="000041.html">[Plearn-commits] r6592 - trunk/plearn_learners/testers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#40">[ date ]</a>
              <a href="thread.html#40">[ thread ]</a>
              <a href="subject.html#40">[ subject ]</a>
              <a href="author.html#40">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
