<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r10258 - trunk/scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r10258%20-%20trunk/scripts&In-Reply-To=%3C200907061705.n66H5Obt012803%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="003699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r10258 - trunk/scripts</H1>
    <B>nouiz at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r10258%20-%20trunk/scripts&In-Reply-To=%3C200907061705.n66H5Obt012803%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r10258 - trunk/scripts">nouiz at mail.berlios.de
       </A><BR>
    <I>Mon Jul  6 19:05:24 CEST 2009</I>
    <P><UL>
        
        <LI>Next message: <A HREF="003699.html">[Plearn-commits] r10259 - trunk/speedtest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3698">[ date ]</a>
              <a href="thread.html#3698">[ thread ]</a>
              <a href="subject.html#3698">[ subject ]</a>
              <a href="author.html#3698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: nouiz
Date: 2009-07-06 19:05:16 +0200 (Mon, 06 Jul 2009)
New Revision: 10258

Modified:
   trunk/scripts/dbidispatch
Log:
added the --fast option for condor.


Modified: trunk/scripts/dbidispatch
===================================================================
--- trunk/scripts/dbidispatch	2009-06-29 13:33:10 UTC (rev 10257)
+++ trunk/scripts/dbidispatch	2009-07-06 17:05:16 UTC (rev 10258)
@@ -36,6 +36,7 @@
                               [--[*no_]keep_failed_jobs_in_queue]
                               [--max_file_size=N][--[no_]debug]
                               [--[no_]local_log_file][--next_job_start_delay=N]
+                              [--fast]
 
 An * after '[', '{' or ',' signals the default value.
 An + tell that we can put one or more separeted by a comma
@@ -212,6 +213,9 @@
       local disk. This help to solv a bug with condor and lock on NFS directory.
   The '--next_job_start_delay=N' option allow to tell condor to wait N second
       between each job we start. Default 0.
+  The '--fast' option tell condor to send the jobs only on fast computer. This 
+      add some hardcoded(maggie, brams and zappa) computers to the list 
+      generated by --machine=...
 
 where &lt;command-template&gt; is interpreted as follows: the first argument
 is the &lt;command&gt; above, and the rest are interpreted as &lt;arguments&gt;.
@@ -254,9 +258,14 @@
 
 &quot;&quot;&quot;%{'ShortHelp':ShortHelp,'ScriptName':ScriptName}
 
+#the computer to use with the --fast option.
+fast_computer=[&quot;maggie&quot;+str(x) for x in [11,12,13,14,15,16,21,22,23,24,25,26,31,32,33,34,35,36,41,42,43,44,45,46]]
+fast_computer+=[&quot;brams0&quot;+str(x) for x in [0,1,2,3,4,5,6,7,'a','b','c','d','e','f']]
+fast_computer+=[&quot;zappa&quot;+str(x) for x in range(1,9)]
+MAX_FILE_NAME_SIZE=255
+
 dbi_param={}
 testmode=False
-MAX_FILE_NAME_SIZE=255
 PATH=os.getenv('PATH')
 if search_file('condor_submit',PATH):
     launch_cmd = 'Condor'
@@ -305,13 +314,14 @@
                    &quot;--getenv&quot;, &quot;--cwait&quot;, &quot;--clean_up&quot; ,&quot;--nice&quot;,
                    &quot;--set_special_env&quot;, &quot;--abs_path&quot;, &quot;--pkdilly&quot;, &quot;--to_all&quot;,
                    &quot;--m32G&quot;, &quot;--keep_failed_jobs_in_queue&quot;, &quot;--restart&quot;,
-                   &quot;--debug&quot;, &quot;--local_log_file&quot;, &quot;--exec_in_exp_dir&quot;]:
+                   &quot;--debug&quot;, &quot;--local_log_file&quot;, &quot;--exec_in_exp_dir&quot;, &quot;--fast&quot;]:
         dbi_param[argv[2:]]=True
     elif argv in [&quot;--no_force&quot;, &quot;--no_interruptible&quot;, &quot;--no_long&quot;,
                   &quot;--no_getenv&quot;, &quot;--no_cwait&quot;, &quot;--no_clean_up&quot; , &quot;--no_nice&quot;,
                   &quot;--no_set_special_env&quot;, &quot;--no_abs_path&quot;, &quot;--no_pkdilly&quot;,
                   &quot;--no_m32G&quot;, &quot;--no_keep_failed_jobs_in_queue&quot;, &quot;--no_restart&quot;,
-                  &quot;--no_debug&quot;, &quot;--no_local_log_file&quot;, &quot;--no_exec_in_exp_dir&quot;]:
+                  &quot;--no_debug&quot;, &quot;--no_local_log_file&quot;, &quot;--no_exec_in_exp_dir&quot;,
+                  &quot;--no_fast&quot;]:
         dbi_param[argv[5:]]=False
     elif argv==&quot;--testdbi&quot;:
         dbi_param[&quot;test&quot;]=True
@@ -500,6 +510,8 @@
 elif dbi_param.get(&quot;restart&quot;,False):
     assert launch_cmd==&quot;Condor&quot;
     cmds=[]
+#    p1_=Popen('condor_q -l -const &quot;JobStatus!=4&quot; '+args(command_argv, shell=True, stdout=PIPE)
+#TODO put condor_history outside the loop as this take much time the we have a not too small history.
     for arg in command_argv:
         #We accept to start jobs in the queue if they are completed
         p1=Popen('condor_q -l -const &quot;JobStatus!=4&quot; '+arg, shell=True, stdout=PIPE)
@@ -542,6 +554,12 @@
     dbi_param[&quot;next_job_start_delay&quot;]=1
     
 
+if dbi_param.get(&quot;fast&quot;,False):
+    dbi_param.setdefault(&quot;machine&quot;,[])
+    for m in fast_computer:
+        dbi_param[&quot;machine&quot;]+=[m+&quot;.iro.umontreal.ca&quot;]
+    del dbi_param[&quot;fast&quot;]
+
 #we duplicate the command so that everything else work correctly.
 if dbi_param.has_key(&quot;to_all&quot;):
     assert(len(commands)==1)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="003699.html">[Plearn-commits] r10259 - trunk/speedtest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3698">[ date ]</a>
              <a href="thread.html#3698">[ thread ]</a>
              <a href="subject.html#3698">[ subject ]</a>
              <a href="author.html#3698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
