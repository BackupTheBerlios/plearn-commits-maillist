<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Plearn-commits] r6738 - in trunk: commands/PLearnCommands	plearn/base plearn/io plearn/python plearn/var plearn/vmat	plearn_learners/generic python_modules/plearn/plide	python_modules/plearn/plide/resources scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/plearn-commits/2007-March/index.html" >
   <LINK REL="made" HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6738%20-%20in%20trunk%3A%20commands/PLearnCommands%0A%09plearn/base%20plearn/io%20plearn/python%20plearn/var%20plearn/vmat%0A%09plearn_learners/generic%20python_modules/plearn/plide%0A%09python_modules/plearn/plide/resources%20scripts&In-Reply-To=%3C200703151933.l2FJXevD005862%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000186.html">
   <LINK REL="Next"  HREF="000188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Plearn-commits] r6738 - in trunk: commands/PLearnCommands	plearn/base plearn/io plearn/python plearn/var plearn/vmat	plearn_learners/generic python_modules/plearn/plide	python_modules/plearn/plide/resources scripts</H1>
    <B>saintmlx at BerliOS</B> 
    <A HREF="mailto:plearn-commits%40lists.berlios.de?Subject=Re%3A%20%5BPlearn-commits%5D%20r6738%20-%20in%20trunk%3A%20commands/PLearnCommands%0A%09plearn/base%20plearn/io%20plearn/python%20plearn/var%20plearn/vmat%0A%09plearn_learners/generic%20python_modules/plearn/plide%0A%09python_modules/plearn/plide/resources%20scripts&In-Reply-To=%3C200703151933.l2FJXevD005862%40sheep.berlios.de%3E"
       TITLE="[Plearn-commits] r6738 - in trunk: commands/PLearnCommands	plearn/base plearn/io plearn/python plearn/var plearn/vmat	plearn_learners/generic python_modules/plearn/plide	python_modules/plearn/plide/resources scripts">saintmlx at mail.berlios.de
       </A><BR>
    <I>Thu Mar 15 20:33:40 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000186.html">[Plearn-commits] r6737 - trunk/doc
</A></li>
        <LI>Next message: <A HREF="000188.html">[Plearn-commits] r6739 - trunk/plearn/math
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#187">[ date ]</a>
              <a href="thread.html#187">[ thread ]</a>
              <a href="subject.html#187">[ subject ]</a>
              <a href="author.html#187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: saintmlx
Date: 2007-03-15 20:33:38 +0100 (Thu, 15 Mar 2007)
New Revision: 6738

Modified:
   trunk/commands/PLearnCommands/HTMLHelpCommand.cc
   trunk/commands/PLearnCommands/HTMLHelpCommand.h
   trunk/commands/PLearnCommands/Plide.cc
   trunk/commands/PLearnCommands/Plide.h
   trunk/plearn/base/OptionBase.cc
   trunk/plearn/base/OptionBase.h
   trunk/plearn/base/RealMapping.cc
   trunk/plearn/io/PStream.cc
   trunk/plearn/python/PythonObjectWrapper.cc
   trunk/plearn/python/PythonObjectWrapper.h
   trunk/plearn/var/VarArray.cc
   trunk/plearn/vmat/BootstrapSplitter.cc
   trunk/plearn/vmat/BootstrapSplitter.h
   trunk/plearn/vmat/BootstrapVMatrix.cc
   trunk/plearn/vmat/BootstrapVMatrix.h
   trunk/plearn_learners/generic/NNet.cc
   trunk/python_modules/plearn/plide/plide.py
   trunk/python_modules/plearn/plide/plide_help.py
   trunk/python_modules/plearn/plide/plide_options.py
   trunk/python_modules/plearn/plide/resources/help_prolog.html
   trunk/scripts/xdispatch
Log:
- added conversion of PyInt to unsigned int
- corrected/clarified some error messages (VarArray, RealMapping)
- option to allow repetitions in Bootstrap{VMatrix|Splitter}
- corrected readAsciiNum for doubles
- new option level 'expert', other mods. to options
- added option levels to Plide and HTML help
- deepCopy cost_funcs and resize costsv in NNet
	


Modified: trunk/commands/PLearnCommands/HTMLHelpCommand.cc
===================================================================
--- trunk/commands/PLearnCommands/HTMLHelpCommand.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/commands/PLearnCommands/HTMLHelpCommand.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -55,6 +55,7 @@
 #include &quot;PLearnCommandRegistry.h&quot;
 #include &quot;plearn_main.h&quot;                     // For version_string
 #include &quot;HTMLHelpCommand.h&quot;
+#include &lt;plearn/base/tostring.h&gt;
 
 namespace PLearn {
 using namespace std;
@@ -289,7 +290,8 @@
             end = TypeFactory::instance().getTypeMap().end()
             ; it != end ; ++it)
     {
-        string helpurl = string(&quot;class_&quot;) + it-&gt;first + &quot;.html&quot;;
+        string helpurl = string(&quot;class_&quot;) + it-&gt;first + &quot;.html?level=&quot; 
+            + tostring(OptionBase::getCurrentOptionLevel());
         string helphtml = &quot;&lt;a href=\&quot;&quot; + helpurl + &quot;\&quot;&gt;&quot; + it-&gt;first + &quot;&lt;/a&gt;&quot;;
         os &lt;&lt; string(&quot;  &lt;tr class=\&quot;&quot;) + (i++%2 == 0? &quot;even&quot; : &quot;odd&quot;) + &quot;\&quot;&gt;&quot; &lt;&lt; endl
            &lt;&lt; &quot;    &lt;td&gt;&quot; + helphtml + &quot;&lt;/td&gt;&quot; &lt;&lt; endl
@@ -305,6 +307,38 @@
 
 //#####  HelpOnClass  #######################################################
 
+string HTMLHelpCommand::flagsAndLevelHeading(const string&amp; classname) const
+{
+    string str= &quot;&lt;div class=\&quot;levelnav\&quot;&gt;&quot;;
+/*
+ * Don't display option flags for now
+    str+= &quot;OptionFlags:&quot;;
+    const OptionBase::StrToFlagMap&amp; flag_map= OptionBase::getStrToFlagMap();
+    for(OptionBase::StrToFlagMap::const_iterator it= flag_map.begin();
+        it != flag_map.end(); ++it)
+    {
+        str+= &quot;&lt;a href=\&quot;toggle_flag_&quot; + tostring(it-&gt;second) + &quot;\&quot;&gt;&quot;;
+        str+= it-&gt;second &amp; OptionBase::getCurrentFlags() ? &quot;[+]&quot; : &quot;[-]&quot;;
+        str+= it-&gt;first + &quot;&lt;/a&gt;&quot;;
+    }
+    str+= &quot;&lt;nbsp&gt;&lt;nbsp&gt;&lt;nbsp&gt;&lt;nbsp&gt;&quot;;
+*/
+    str+= &quot;OptionLevel:&quot;;
+    const OptionBase::LevelToStrMap&amp; lev_map= OptionBase::getLevelToStrMap();
+    for(OptionBase::LevelToStrMap::const_iterator it= lev_map.begin();
+        it != lev_map.end(); ++it)
+    {
+        if(it-&gt;first == OptionBase::getCurrentOptionLevel())
+            str+= &quot;&lt;b&gt;&quot; + it-&gt;second + &quot;&lt;/b&gt;&quot;;
+        else
+            str+= &quot;&lt;a href=\&quot;class_&quot; + classname + &quot;.html?level=&quot; 
+                + tostring(it-&gt;first) + &quot;\&quot;&gt;&quot; + it-&gt;second + &quot;&lt;/a&gt;&quot;;
+    }
+    str+= &quot;&lt;/div&gt;&quot;;
+    return str;
+}
+
+
 void HTMLHelpCommand::helpOnClass(const string&amp; classname)
 {
     PLASSERT( config );
@@ -329,12 +363,15 @@
     const TypeMapEntry&amp; entry = it-&gt;second;
     Object* obj = 0;
 
+    out &lt;&lt; flagsAndLevelHeading(classname);
+
     // Determine list of parent classes and print it out as crumbtrail
     TVec&lt;string&gt; parents = parent_classes(classname);
     out &lt;&lt; &quot;&lt;div class=\&quot;crumbtrail\&quot;&gt;&quot;;
     for (int i=0, n=parents.size() ; i&lt;n ; ++i) {
         if (i &lt; n-1)
-            out &lt;&lt; &quot;&lt;a href=\&quot;class_&quot; + parents[i] + &quot;.html\&quot;&gt;&quot;
+            out &lt;&lt; &quot;&lt;a href=\&quot;class_&quot; + parents[i] + &quot;.html?level=&quot;
+                + tostring(OptionBase::getCurrentOptionLevel()) + &quot;\&quot;&gt;&quot;
                 &lt;&lt; parents[i] &lt;&lt; &quot;&lt;/a&gt;&nbsp;&gt; &quot;;
         else
             out &lt;&lt; parents[i];
@@ -376,12 +413,16 @@
         string descr    = (*olIt)-&gt;description();
         string optname  = (*olIt)-&gt;optionname();
         string opttype  = (*olIt)-&gt;optiontype();
+        string optlevel = (*olIt)-&gt;levelString();
         string defclass = &quot;&quot;;
         string defaultval = &quot;?&quot;;
 
         // Determine the flag rendering
         string flag_string = join((*olIt)-&gt;flagStrings(), &quot; | &quot;);
-    
+
+        if((*olIt)-&gt;level() &gt; OptionBase::getCurrentOptionLevel()
+            || 0 == ((*olIt)-&gt;flags() &amp; OptionBase::getCurrentFlags()))
+            continue;
         if(obj) // it's an instantiable class
         {
             defaultval = (*olIt)-&gt;defaultval(); 
@@ -398,6 +439,7 @@
         if (defaultval != &quot;?&quot;)
             out &lt;&lt; &quot;    &lt;div class=\&quot;optvalue\&quot;&gt;= &quot; &lt;&lt; quote(defaultval) &lt;&lt; &quot;&lt;/div&gt;&quot; &lt;&lt; endl;
         out &lt;&lt; &quot;    &lt;div class=\&quot;opttype\&quot;&gt;&lt;i&gt;(&quot; &lt;&lt; flag_string &lt;&lt; &quot;)&lt;/i&gt;&lt;/div&gt;&quot; &lt;&lt; endl;
+        out &lt;&lt; &quot;    &lt;div class=\&quot;optlevel\&quot;&gt;&lt;i&gt;(OptionLevel: &quot; &lt;&lt; optlevel &lt;&lt; &quot;)&lt;/i&gt;&lt;/div&gt;&quot; &lt;&lt; endl;
         out &lt;&lt; &quot;    &lt;/td&gt;&quot; &lt;&lt; endl;
         if (removeblanks(descr) == &quot;&quot;)
             descr = &quot;(no description)&quot;;
@@ -433,7 +475,8 @@
         {
             Object* o = (*e.constructor)();
             if( (*entry.isa_method)(o) ) {
-                string helpurl = string(&quot;class_&quot;) + it-&gt;first + &quot;.html&quot;;
+                string helpurl = string(&quot;class_&quot;) + it-&gt;first + &quot;.html&quot;
+                    + &quot;?level=&quot; + tostring(OptionBase::getCurrentOptionLevel());
                 out &lt;&lt; string(&quot;  &lt;tr class=\&quot;&quot;) +
                        (index++%2 == 0? &quot;even&quot; : &quot;odd&quot;) + &quot;\&quot;&gt;&quot; &lt;&lt; endl
                     &lt;&lt; &quot;    &lt;td&gt;&lt;a href=\&quot;&quot; &lt;&lt; helpurl &lt;&lt; &quot;\&quot;&gt;&quot;
@@ -595,7 +638,9 @@
       
             // ensure we only match whole words with the regular expression
             const boost::regex e(&quot;\\&lt;&quot; + tokens[i] + &quot;\\&gt;&quot;);
-            const string repl_str(&quot;&lt;a href=\&quot;class_$&amp;.html\&quot;&gt;$&amp;&lt;/a&gt;&quot;);
+            const string repl_str(&quot;&lt;a href=\&quot;class_$&amp;.html\\?level=&quot;
+                                  + tostring(OptionBase::getCurrentOptionLevel()) 
+                                  +&quot;\&quot;&gt;$&amp;&lt;/a&gt;&quot;);
             typestr = regex_replace(typestr, e, repl_str, boost::match_default | boost::format_default);
         }
     }

Modified: trunk/commands/PLearnCommands/HTMLHelpCommand.h
===================================================================
--- trunk/commands/PLearnCommands/HTMLHelpCommand.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/commands/PLearnCommands/HTMLHelpCommand.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -99,6 +99,9 @@
   
     //! Generate a &quot;generated by&quot; remark
     virtual string generated_by() const;
+
+    //! Generate flags and level heading for class options
+    virtual string flagsAndLevelHeading(const string&amp; classname) const;
   
 public:
     HTMLHelpCommand();

Modified: trunk/commands/PLearnCommands/Plide.cc
===================================================================
--- trunk/commands/PLearnCommands/Plide.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/commands/PLearnCommands/Plide.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -249,6 +249,8 @@
     m_python-&gt;inject(&quot;helpClasses&quot;,       this, &amp;Plide::helpClasses);
     m_python-&gt;inject(&quot;helpOnCommand&quot;,     this, &amp;Plide::helpOnCommand);
     m_python-&gt;inject(&quot;helpOnClass&quot;,       this, &amp;Plide::helpOnClass);
+    m_python-&gt;inject(&quot;setOptionLevel&quot;,    this, &amp;Plide::setOptionLevel);
+    m_python-&gt;inject(&quot;toggleOptionFlag&quot;,  this, &amp;Plide::toggleOptionFlag);
     m_python-&gt;inject(&quot;precisOnClass&quot;,     this, &amp;Plide::precisOnClass);
     m_python-&gt;inject(&quot;loggingControl&quot;,    this, &amp;Plide::loggingControl);
 
@@ -425,6 +427,25 @@
     return os.str();
 }
 
+PythonObjectWrapper Plide::setOptionLevel(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const
+{
+    if (args.size() != 1)
+        PLERROR(&quot;%sExpecting 1 argument; got %d&quot;, __FUNCTION__, args.size());
+    OptionBase::OptionLevel desired_level = args[0].as&lt;OptionBase::OptionLevel&gt;();
+    OptionBase::setCurrentOptionLevel(desired_level);
+    return PythonObjectWrapper();
+}
+
+PythonObjectWrapper Plide::toggleOptionFlag(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const
+{
+    if (args.size() != 1)
+        PLERROR(&quot;%sExpecting 1 argument; got %d&quot;, __FUNCTION__, args.size());
+    OptionBase::flag_t flag_to_toggle = args[0].as&lt;OptionBase::flag_t&gt;();
+    OptionBase::setCurrentFlags(OptionBase::getCurrentFlags() ^ flag_to_toggle);
+    return PythonObjectWrapper();
+}
+
+
 PythonObjectWrapper Plide::precisOnClass(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const
 {
     if (args.size() != 1)

Modified: trunk/commands/PLearnCommands/Plide.h
===================================================================
--- trunk/commands/PLearnCommands/Plide.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/commands/PLearnCommands/Plide.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -95,6 +95,10 @@
     
     //! Generate documentation for a given class
     PythonObjectWrapper helpOnClass(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const;
+    //! Option level for class help
+    PythonObjectWrapper setOptionLevel(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const;
+    //! Toggle flags to display for class help
+    PythonObjectWrapper toggleOptionFlag(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const;
 
     //! Generate the short (one-line) documentation for a given class, as well
     //! as the list of all BUILD options it supports.  This is returned as a pair
@@ -105,7 +109,6 @@
     //! 1) Desired verbosity level (integer)
     //! 2) List of module names to activate in named logging (list of strings)
     PythonObjectWrapper loggingControl(const TVec&lt;PythonObjectWrapper&gt;&amp; args) const;
-    
 
     //#####  Work Executors  ##################################################
 

Modified: trunk/plearn/base/OptionBase.cc
===================================================================
--- trunk/plearn/base/OptionBase.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/base/OptionBase.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -56,10 +56,18 @@
 const OptionBase::flag_t OptionBase::nonparentable    = 1 &lt;&lt; 4;
 const OptionBase::flag_t OptionBase::nontraversable   = 1 &lt;&lt; 5;
 const OptionBase::flag_t OptionBase::remotetransmit   = 1 &lt;&lt; 6;
+OptionBase::flag_t OptionBase::current_flags_= (OptionBase::buildoption 
+                                                | OptionBase::learntoption 
+                                                | OptionBase::tuningoption
+                                                | OptionBase::nosave
+                                                | OptionBase::nonparentable
+                                                | OptionBase::nontraversable
+                                                | OptionBase::remotetransmit);
 
-const OptionBase::OptionLevel OptionBase::basic_level= 200;
-const OptionBase::OptionLevel OptionBase::normal_level= 400;
-const OptionBase::OptionLevel OptionBase::advanced_level= 800;
+const OptionBase::OptionLevel OptionBase::basic_level= 100;
+const OptionBase::OptionLevel OptionBase::normal_level= 200;
+const OptionBase::OptionLevel OptionBase::advanced_level= 400;
+const OptionBase::OptionLevel OptionBase::expert_level= 800;
 const OptionBase::OptionLevel OptionBase::experimental_level= 9999;
 const OptionBase::OptionLevel OptionBase::deprecated_level= 99999999;
 const OptionBase::OptionLevel OptionBase::default_level= OptionBase::normal_level;
@@ -111,26 +119,42 @@
             &quot;of type '%s'&quot;, optionname().c_str(), optiontype().c_str());
 }
 
+OptionBase::StrToFlagMap OptionBase::str_to_flag; //!&lt; init.
+const OptionBase::StrToFlagMap&amp; OptionBase::getStrToFlagMap()
+{
+    if(str_to_flag.size() == 0)
+    {
+        getFlagToStrMap();//make sure it is filled
+        for(FlagToStrMap::iterator it= flag_to_str.begin();
+            it != flag_to_str.end(); ++it)
+            str_to_flag[it-&gt;second]= it-&gt;first;
+    }
+    return str_to_flag;
+}
 
+OptionBase::FlagToStrMap OptionBase::flag_to_str; //!&lt; init.
+const OptionBase::FlagToStrMap&amp; OptionBase::getFlagToStrMap()
+{
+    if (flag_to_str.size() == 0) 
+    {
+        flag_to_str[buildoption   ] = &quot;buildoption&quot;;
+        flag_to_str[learntoption  ] = &quot;learntoption&quot;;
+        flag_to_str[tuningoption  ] = &quot;tuningoption&quot;;
+        flag_to_str[nosave        ] = &quot;nosave&quot;;
+        flag_to_str[nonparentable ] = &quot;nonparentable&quot;;
+        flag_to_str[nontraversable] = &quot;nontraversable&quot;;
+        flag_to_str[remotetransmit] = &quot;remotetransmit&quot;;
+    }
+    return flag_to_str;
+}
 vector&lt;string&gt; OptionBase::flagStrings() const
 {
     flag_t curflags = flags();
     vector&lt;string&gt; fs;
 
-    static bool initialized = false;
-    static map&lt;flag_t, string&gt; flag_map;
-    if (! initialized) {
-        flag_map[buildoption   ] = &quot;buildoption&quot;;
-        flag_map[learntoption  ] = &quot;learntoption&quot;;
-        flag_map[tuningoption  ] = &quot;tuningoption&quot;;
-        flag_map[nosave        ] = &quot;nosave&quot;;
-        flag_map[nonparentable ] = &quot;nonparentable&quot;;
-        flag_map[nontraversable] = &quot;nontraversable&quot;;
-        flag_map[remotetransmit] = &quot;remotetransmit&quot;;
-        initialized = true;
-    }
+    const FlagToStrMap&amp; flag_map= getFlagToStrMap();
 
-    for (map&lt;flag_t, string&gt;::const_iterator it = flag_map.begin(),
+    for (FlagToStrMap::const_iterator it = flag_map.begin(),
              end = flag_map.end() ; it != end ; ++it)
     {
         // As we process each option, turn it off in temporary copy of flags to
@@ -151,32 +175,44 @@
 
 
 OptionBase::StrToLevelMap OptionBase::str_to_level; //!&lt; init.
-OptionBase::OptionLevel OptionBase::optionLevelFromString(const string&amp; s)
+const OptionBase::StrToLevelMap&amp; OptionBase::getStrToLevelMap()
 {
     if(str_to_level.size() == 0)
     {
         str_to_level[&quot;basic&quot;]= basic_level;
         str_to_level[&quot;normal&quot;]= normal_level;
         str_to_level[&quot;advanced&quot;]= advanced_level;
+        str_to_level[&quot;expert&quot;]= expert_level;
         str_to_level[&quot;experimental&quot;]= experimental_level;
         str_to_level[&quot;deprecated&quot;]= deprecated_level;
     }
+    return str_to_level;
+}
+
+OptionBase::OptionLevel OptionBase::optionLevelFromString(const string&amp; s)
+{
+    getStrToLevelMap();//make sure it is filled
     StrToLevelMap::iterator it= str_to_level.find(lowerstring(s));
     if(it != str_to_level.end()) return it-&gt;second;
     return (OptionLevel)toint(s);
 }
 
 OptionBase::LevelToStrMap OptionBase::level_to_str; //!&lt; init.
-string OptionBase::optionLevelToString(const OptionLevel&amp; l)
+const OptionBase::LevelToStrMap&amp; OptionBase::getLevelToStrMap()
 {
     if(level_to_str.size() == 0)
     {
-        if(str_to_level.size() == 0) 
-            optionLevelFromString(&quot;0&quot;);//populate str_to_level
+        getStrToLevelMap();//make sure it is filled
         for(StrToLevelMap::iterator it= str_to_level.begin();
             it != str_to_level.end(); ++it)
             level_to_str[it-&gt;second]= it-&gt;first;
     }
+    return level_to_str;
+}
+
+string OptionBase::optionLevelToString(const OptionLevel&amp; l)
+{
+    getLevelToStrMap();//make sure it is filled
     LevelToStrMap::iterator it= level_to_str.find(l);
     if(it != level_to_str.end()) return it-&gt;second;
     return tostring(l);

Modified: trunk/plearn/base/OptionBase.h
===================================================================
--- trunk/plearn/base/OptionBase.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/base/OptionBase.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -135,18 +135,25 @@
     static const OptionLevel basic_level; //!&lt; mandatory options
     static const OptionLevel normal_level; //!&lt; simple, useful options
     static const OptionLevel advanced_level; //!&lt; useful but seldom used
+    static const OptionLevel expert_level; //!&lt; more than advanced, not experimental
     static const OptionLevel experimental_level; //!&lt; only a few people understand those
     static const OptionLevel deprecated_level; //!&lt; should not be used anymore
     static const OptionLevel default_level; //!&lt; default for options w/o explicit level
 
+    typedef map&lt;string, OptionLevel&gt; StrToLevelMap;
+    typedef map&lt;OptionLevel, string&gt; LevelToStrMap;
+    typedef map&lt;string, flag_t&gt; StrToFlagMap;
+    typedef map&lt;flag_t, string&gt; FlagToStrMap;
 protected:
     static OptionLevel current_option_level_;
-
-    typedef map&lt;string, OptionLevel&gt; StrToLevelMap;
-    typedef map&lt;OptionLevel, string&gt; LevelToStrMap;
     static StrToLevelMap str_to_level;
     static LevelToStrMap level_to_str;
 
+    //! to toggle display of options by option flags
+    static flag_t current_flags_;
+    static StrToFlagMap str_to_flag;
+    static FlagToStrMap flag_to_str;
+
 protected:
     string optionname_;  //!&lt; the name of the option
     flag_t flags_; 
@@ -288,11 +295,24 @@
     static const OptionLevel&amp; getCurrentOptionLevel() { return current_option_level_; }
     //! set the current option level for help text
     static void setCurrentOptionLevel(const OptionLevel&amp; l) { current_option_level_= l; }
+    //! Get map (name-&gt;level) of all option levels
+    static const StrToLevelMap&amp; getStrToLevelMap();
+    //! Get map (level-&gt;) of all option levels
+    static const LevelToStrMap&amp; getLevelToStrMap();
     //! convert string to OptionLevel
     static OptionLevel optionLevelFromString(const string&amp; s);
     //! convert OptionLevel to string
     static string optionLevelToString(const OptionLevel&amp; l);
 
+    //! get the current option level for help text
+    static const flag_t&amp; getCurrentFlags() { return current_flags_; }
+    //! set the current option level for help text
+    static void setCurrentFlags(const flag_t&amp; f) { current_flags_= f; }
+    //! Get map (name-&gt;flag) of all possible flags
+    static const StrToFlagMap&amp; getStrToFlagMap();
+    //! Get map (flag-&gt;name) of all possible flags
+    static const FlagToStrMap&amp; getFlagToStrMap();
+
 };
 
 typedef std::vector&lt; PP&lt;OptionBase&gt; &gt; OptionList;

Modified: trunk/plearn/base/RealMapping.cc
===================================================================
--- trunk/plearn/base/RealMapping.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/base/RealMapping.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -337,8 +337,10 @@
             real val0, val;
             in &gt;&gt; val0 &gt;&gt; ws;
             r= RealRange('[', val0, val0, ']');
-            if(in.get()!='-' || in.get()!='&gt;')
-                PLERROR(&quot;Expecting -&gt; after range specification ( range syntax example : ]100 200] -&gt; 10 )&quot;);
+            char c0= in.get();
+            char c1= in.get();
+            if(c0!='-' || c1!='&gt;')
+                PLERROR(&quot;Expecting '-&gt;' in mapping (syntax example : '100 -&gt; 10') got '%c%c' instead&quot;,c0,c1);
             in &gt;&gt; val;
             addMapping(r,val);	    
         }

Modified: trunk/plearn/io/PStream.cc
===================================================================
--- trunk/plearn/io/PStream.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/io/PStream.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -728,7 +728,13 @@
         opposite = true;
         c = get();
     }
+    else if (c == '+') // skip + sign
+        c = get();
 
+    bool E_seen= false;
+    bool sign_seen= false;
+    bool dot_seen= false;
+
     switch(c)
     {
     case '?':
@@ -753,8 +759,14 @@
             PLERROR(error_msg);
         break ; 
     default:
-        while(isdigit(c) || c=='-' || c=='+' || c=='.' || c=='e' || c=='E')
+        while(isdigit(c) 
+              || ((c=='e' || c=='E') &amp;&amp; !E_seen) //only one E
+              || ((c=='-' || c=='+') &amp;&amp; E_seen &amp;&amp; !sign_seen)//one sign, after E 
+              || (c=='.' &amp;&amp; !E_seen &amp;&amp; !dot_seen))//one dot, before E
         {
+            if(c=='e' || c=='E') E_seen= true;
+            if(c=='+' || c=='-') sign_seen= true;
+            if(c=='.') dot_seen= true;
             tmpbuf[l++] = c;
             c = get();
         }

Modified: trunk/plearn/python/PythonObjectWrapper.cc
===================================================================
--- trunk/plearn/python/PythonObjectWrapper.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/python/PythonObjectWrapper.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -94,6 +94,14 @@
     return int(PyInt_AS_LONG(pyobj));
 }
 
+int ConvertFromPyObject&lt;unsigned int&gt;::convert(PyObject* pyobj, bool print_traceback)
+{
+    PLASSERT( pyobj );
+    if (! PyInt_Check(pyobj))
+        PLPythonConversionError(&quot;ConvertFromPyObject&lt;unsigned int&gt;&quot;, pyobj, print_traceback);
+    return static_cast&lt;unsigned int&gt;(PyInt_AsUnsignedLongMask(pyobj));
+}
+
 long ConvertFromPyObject&lt;long&gt;::convert(PyObject* pyobj, bool print_traceback)
 {
     PLASSERT( pyobj );

Modified: trunk/plearn/python/PythonObjectWrapper.h
===================================================================
--- trunk/plearn/python/PythonObjectWrapper.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/python/PythonObjectWrapper.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -149,6 +149,12 @@
 };
 
 template &lt;&gt;
+struct ConvertFromPyObject&lt;unsigned int&gt;
+{
+    static int convert(PyObject*, bool print_traceback);
+};
+
+template &lt;&gt;
 struct ConvertFromPyObject&lt;long&gt;
 {
     static long convert(PyObject*, bool print_traceback);

Modified: trunk/plearn/var/VarArray.cc
===================================================================
--- trunk/plearn/var/VarArray.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/var/VarArray.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -1182,7 +1182,8 @@
         Vec&amp; ar_v = ar[k]-&gt;value;
         Vec&amp; v = values[k];
         if(ar_v.size() != v.size())
-            PLERROR(&quot;In operator&lt;&lt;(VarArray&amp;, const Array&lt;Vec&gt;&amp;) sizes of vector %d differ (in VarArray:%d, in Array&lt;Vec&gt;:%d)&quot;,ar_v.size(),v.size());
+            PLERROR(&quot;In operator&lt;&lt;(VarArray&amp;, const Array&lt;Vec&gt;&amp;) sizes of var array and vector differ.  &quot;
+                    &quot;(VarArray length:%d, in Array&lt;Vec&gt;, Vec length:%d)&quot;,ar_v.size(),v.size());
         ar_v &lt;&lt; v;
     }
 }
@@ -1197,7 +1198,8 @@
         Vec&amp; ar_v = ar[k]-&gt;value;
         Vec&amp; v = values[k];
         if(ar_v.size() != v.size())
-            PLERROR(&quot;In operator&lt;&lt;(VarArray&amp;, const Array&lt;Vec&gt;&amp;) sizes of vector %d differ (in VarArray:%d, in Array&lt;Vec&gt;:%d)&quot;,ar_v.size(),v.size());
+            PLERROR(&quot;In operator&lt;&lt;(VarArray&amp;, const Array&lt;Vec&gt;&amp;) sizes of var array and vector differ.  &quot;
+                    &quot;(VarArray length:%d, in Array&lt;Vec&gt;, Vec length:%d)&quot;,ar_v.size(),v.size());
         ar_v &gt;&gt; v;
     }
 }

Modified: trunk/plearn/vmat/BootstrapSplitter.cc
===================================================================
--- trunk/plearn/vmat/BootstrapSplitter.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/vmat/BootstrapSplitter.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -47,7 +47,8 @@
 BootstrapSplitter::BootstrapSplitter()
     :Splitter(),
      frac(0.6667),
-     n_splits(0)
+     n_splits(0),
+     allow_repetitions(false)
     /* ### Initialise all fields to their default value */
 {
 }
@@ -70,6 +71,10 @@
     declareOption(ol, &quot;frac&quot;, &amp;BootstrapSplitter::frac, OptionBase::buildoption,
                   &quot;the fraction of elements to take in each bootstrap&quot;);
 
+    declareOption(ol, &quot;allow_repetitions&quot;, &amp;BootstrapSplitter::allow_repetitions, 
+                  OptionBase::buildoption,
+                  &quot;Allows each row to appear more than once per split.&quot;);
+
     // Now call the parent class' declareOptions
     inherited::declareOptions(ol);
 }
@@ -88,7 +93,9 @@
         bootstrapped_sets.resize(n_splits,1);
         for (int i = 0; i &lt; n_splits; i++) {
             // Construct a new bootstrap sample from the dataset.
-            bootstrapped_sets(i,0) = new BootstrapVMatrix(dataset,frac);
+            
+            // FIXME: 'seed' param should not be -2; see [and fix] BootstrapVMatrix.
+            bootstrapped_sets(i,0) = new BootstrapVMatrix(dataset,frac,-2,allow_repetitions);
         }
     } else {
         bootstrapped_sets.resize(0,0);

Modified: trunk/plearn/vmat/BootstrapSplitter.h
===================================================================
--- trunk/plearn/vmat/BootstrapSplitter.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/vmat/BootstrapSplitter.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -74,6 +74,7 @@
     // ### declare public option fields (such as build options) here
     real frac;
     int n_splits;
+    bool allow_repetitions;
 
     // ****************
     // * Constructors *

Modified: trunk/plearn/vmat/BootstrapVMatrix.cc
===================================================================
--- trunk/plearn/vmat/BootstrapVMatrix.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/vmat/BootstrapVMatrix.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -48,7 +48,8 @@
 PLEARN_IMPLEMENT_OBJECT(BootstrapVMatrix,
                         &quot;A VMatrix that sees a bootstrap subset of its parent VMatrix.&quot;,
                         &quot;It means that a random sample of the source will be taken.\n&quot;
-                        &quot;Note that this is not a real bootstrap since a sample can only appear once.&quot;
+                        &quot;[THE FOLLOWING LINE IS NOT TRUE ANYMORE (see allow_repetitions):\n&quot;
+                        &quot;Note that this is not a real bootstrap since a sample can only appear once.]&quot;
     );
 
 //////////////////////
@@ -60,17 +61,19 @@
     n_elems(-1),
     own_seed(-2), // -2 = hack value while 'seed' is still there
     seed(0),
-    shuffle(false)
+    shuffle(false),
+    allow_repetitions(false)
 {}
 
 BootstrapVMatrix::BootstrapVMatrix(VMat m, real the_frac, bool the_shuffle,
-                                   long the_seed):
+                                   long the_seed, bool allow_rep):
     rgen(new PRandom()),
     frac(the_frac),
     n_elems(-1),
     own_seed(the_seed),
     seed(0),
-    shuffle(the_shuffle)
+    shuffle(the_shuffle),
+    allow_repetitions(allow_rep)
 {
     this-&gt;source = m;
     build();
@@ -97,6 +100,11 @@
                   &quot;DEPRECATED: The random generator seed (-1 = initialized from clock, 0 = no initialization).\n&quot;
                   &quot;Warning: this is a global seed that may affect other PLearn objects.&quot;);
 
+    declareOption(ol, &quot;allow_repetitions&quot;, &amp;BootstrapVMatrix::allow_repetitions, 
+                  OptionBase::buildoption,
+                  &quot;Wether examples should be allowed to appear each more than once.&quot;,
+                  &quot;&quot;, OptionBase::advanced_level);
+
     inherited::declareOptions(ol);
 
     // Hide the 'indices' option, because it will be overridden at build time.
@@ -118,6 +126,17 @@
 ////////////
 void BootstrapVMatrix::build_()
 {
+    if(allow_repetitions)
+    {
+        int l= source.length();
+        indices.resize(l);
+        for(int i= 0; i &lt; l; ++i)
+            indices[i]= rgen-&gt;uniform_multinomial_sample(l);
+        // Because we changed the indices, a rebuild may be needed.
+        inherited::build();
+        return;//avoid extra indentation
+    }
+
     if (source) {
         indices = TVec&lt;int&gt;(0, source.length()-1, 1); // Range-vector
         if (seed != 0)

Modified: trunk/plearn/vmat/BootstrapVMatrix.h
===================================================================
--- trunk/plearn/vmat/BootstrapVMatrix.h	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn/vmat/BootstrapVMatrix.h	2007-03-15 19:33:38 UTC (rev 6738)
@@ -65,6 +65,7 @@
     long own_seed;
     long seed;
     bool shuffle;
+    bool allow_repetitions;
 
 public:
 
@@ -73,7 +74,8 @@
 
     //! Construct a boostrap of another VMatrix.
     //! Note: 'the_seed' sets the new 'own_seed' option, not the old 'seed' one.
-    BootstrapVMatrix(VMat m, real frac, bool shuffle = false, long the_seed = -2);
+    BootstrapVMatrix(VMat m, real frac, bool shuffle = false, long the_seed = -2,
+                     bool allow_rep= false);
 
     PLEARN_DECLARE_OBJECT(BootstrapVMatrix);
 

Modified: trunk/plearn_learners/generic/NNet.cc
===================================================================
--- trunk/plearn_learners/generic/NNet.cc	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/plearn_learners/generic/NNet.cc	2007-03-15 19:33:38 UTC (rev 6738)
@@ -816,6 +816,7 @@
         PLERROR(&quot;In NNet::computeCostsFromOutputs - Cannot directly compute stable &quot;
                 &quot;cross entropy from output and target&quot;);
 #endif
+    costsv.resize(nTestCosts());
     output_and_target_to_cost-&gt;fprop(outputv&amp;targetv, costsv); 
 }
 
@@ -977,17 +978,9 @@
 /////////////////////////////////
 void NNet::makeDeepCopyFromShallowCopy(CopiesMap&amp; copies)
 {
+
     inherited::makeDeepCopyFromShallowCopy(copies);
-    varDeepCopyField(input, copies);
-    varDeepCopyField(target, copies);
-    varDeepCopyField(sampleweight, copies);
-    varDeepCopyField(w1, copies);
-    varDeepCopyField(w2, copies);
-    varDeepCopyField(wout, copies);
-    varDeepCopyField(outbias, copies);
-    varDeepCopyField(wdirect, copies);
-    varDeepCopyField(wrec, copies);
-    varDeepCopyField(hidden_layer, copies);
+    // protected:
     varDeepCopyField(rbf_centers, copies);
     varDeepCopyField(rbf_sigmas, copies);
     varDeepCopyField(junk_prob, copies);
@@ -1000,11 +993,23 @@
     varDeepCopyField(test_costs, copies);
     deepCopyField(invars, copies);
     deepCopyField(params, copies);
+    // public:
     deepCopyField(paramsvalues, copies);
+    varDeepCopyField(input, copies);
+    varDeepCopyField(target, copies);
+    varDeepCopyField(sampleweight, copies);
+    varDeepCopyField(w1, copies);
+    varDeepCopyField(w2, copies);
+    varDeepCopyField(wout, copies);
+    varDeepCopyField(outbias, copies);
+    varDeepCopyField(wdirect, copies);
+    varDeepCopyField(wrec, copies);
+    varDeepCopyField(hidden_layer, copies);
     deepCopyField(f, copies);
     deepCopyField(test_costf, copies);
     deepCopyField(output_and_target_to_cost, copies);
     varDeepCopyField(first_hidden_layer, copies);
+    deepCopyField(cost_funcs, copies);
     deepCopyField(optimizer, copies);
 }
 

Modified: trunk/python_modules/plearn/plide/plide.py
===================================================================
--- trunk/python_modules/plearn/plide/plide.py	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/python_modules/plearn/plide/plide.py	2007-03-15 19:33:38 UTC (rev 6738)
@@ -841,7 +841,7 @@
 
 #####  C++ Functional Interface  ############################################
 
-# global plide_main_window
+#global plide_main_window
 plide_main_window = None
 
 def StartPlide(argv = []):

Modified: trunk/python_modules/plearn/plide/plide_help.py
===================================================================
--- trunk/python_modules/plearn/plide/plide_help.py	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/python_modules/plearn/plide/plide_help.py	2007-03-15 19:33:38 UTC (rev 6738)
@@ -76,7 +76,7 @@
         self.view.show_all()
 
         plide_main.w_help_scrolledwindow.add(self.view)
-
+        
     def define_injected( inj ):
         &quot;&quot;&quot;Simply transmits the 'injected' pseudo-module to this module.
         &quot;&quot;&quot;
@@ -92,7 +92,7 @@
     def link_clicked( self, doc, uri ):
         &quot;&quot;&quot;Callback that's invoked when HTML widget reports that a link has
         been clicked by the user.
-        &quot;&quot;&quot;
+        &quot;&quot;&quot;       
         self.display_page(uri)
 
     def display_page( self, uri, doc = None ):
@@ -103,6 +103,7 @@
             self.back_pages.append(self.cur_page)
         self.cur_page  = uri
         self.fwd_pages = []
+        
         title = self.update_doc_from_uri(uri)
         self.update_title(title)
 
@@ -139,6 +140,18 @@
         if doc is None:
             doc = self.doc
 
+        # params
+        posparams= uri.find('?')
+        poslev= uri.find(&quot;level=&quot;, posparams)
+        if poslev != -1:
+            posend= uri.find(&quot;;&quot;,poslev)
+            if posend == -1:
+                posend= len(uri)
+            injected.setOptionLevel(int(uri[poslev+6:posend]))
+        if posparams != -1:
+            # get rid of params here
+            uri= uri[:posparams]
+
         html  = &quot;&quot;
         title = &quot;&quot;
         if uri == &quot;index.html&quot;:

Modified: trunk/python_modules/plearn/plide/plide_options.py
===================================================================
--- trunk/python_modules/plearn/plide/plide_options.py	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/python_modules/plearn/plide/plide_options.py	2007-03-15 19:33:38 UTC (rev 6738)
@@ -32,7 +32,8 @@
 import gtk
 
 from plearn.utilities.metaprog import public_members
-from plearn.pyplearn.pyplearn  import *
+#from plearn.pyplearn.pyplearn  import *
+from plearn.pyplearn           import *
 from plearn.utilities.toolkit  import doc as toolkit_doc
 
 from plearn.pl_pygtk import GladeAppWindow, GladeDialog, MessageBox

Modified: trunk/python_modules/plearn/plide/resources/help_prolog.html
===================================================================
--- trunk/python_modules/plearn/plide/resources/help_prolog.html	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/python_modules/plearn/plide/resources/help_prolog.html	2007-03-15 19:33:38 UTC (rev 6738)
@@ -82,6 +82,7 @@
 .opttype  { color:#007AA8; font-family:monospace; font-size:85% }
 .optname  { font-weight: bold; font-size: 110%; font-style: italic }
 .optvalue { color:#007AA8; font-family:monospace; font-size:85% }
+.optlevel  { color:#007AA8; font-family:monospace; font-size:85% }
 
 .rmitable                 { margin: 3ex 0px 0px; padding: 0px 0px 0px 10px}
 .rmitable table           { width:100%; }
@@ -107,6 +108,22 @@
 .fromclass { font-style: italic } 
 address { padding-left: 10px ; padding-right: 15px ; border-top: 1px solid #809fff ; font-size:80%; }
 
+
+.levelnav             { background-color: #007AA8; color: #FFFFFF;
+                        /* font-style: italic; */
+			font-size:75%;
+                        text-align: right;
+                        padding: 3px 0px;
+                        /* border-top: 1px solid #809FFF; */
+                        border-bottom: 1px solid #809FFF;
+                        border-right: 0px;
+			border-left: 0px; }
+
+.levelnav a           { color: #CDC5FF; border-left: 1px solid #809FFF; }
+.levelnav a:hover     { background-color: #005676 }
+.levelnav b           { color: #FFFFFF; border-left: 1px solid #809FFF; }
+
+
 &lt;/style&gt;
 &lt;title&gt;PLearn User-Level Documentation&lt;/title&gt;
 &lt;/head&gt;
@@ -114,4 +131,4 @@
 &lt;div class=&quot;topnav&quot;&gt;
   &lt;a href=&quot;index.html&quot;&gt;Main Index&lt;/a&gt;&lt;a href=&quot;class_index.html&quot;&gt;Class Index&lt;/a&gt;&lt;a href=&quot;command_index.html&quot;&gt;Command Index&lt;/a&gt;
 &lt;/div&gt;
-&lt;!-- &lt;div id=&quot;banner&quot;&gt;&lt;/div&gt; --&gt;
+&lt;!-- &lt;div id=&quot;banner&quot;&gt;&lt;/div&gt; --&gt;
\ No newline at end of file

Modified: trunk/scripts/xdispatch
===================================================================
--- trunk/scripts/xdispatch	2007-03-15 14:06:59 UTC (rev 6737)
+++ trunk/scripts/xdispatch	2007-03-15 19:33:38 UTC (rev 6738)
@@ -76,7 +76,7 @@
             os.close(tf)
 
             print &quot;Servers listed in: &quot;, fname
-            cmd= plearn_command + ' --servers ' + fname + ' ' + ' '.join(args[1:])
+            cmd= 'time nice ' + plearn_command + ' --servers ' + fname + ' ' + ' '.join(args[1:])
             print cmd
 
             # call the master w/ all options plus a list of slave servers


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000186.html">[Plearn-commits] r6737 - trunk/doc
</A></li>
	<LI>Next message: <A HREF="000188.html">[Plearn-commits] r6739 - trunk/plearn/math
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#187">[ date ]</a>
              <a href="thread.html#187">[ thread ]</a>
              <a href="subject.html#187">[ subject ]</a>
              <a href="author.html#187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/plearn-commits">More information about the Plearn-commits
mailing list</a><br>
</body></html>
